<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-01-03 Tue 14:38 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ray Tracing</title>
<meta name="author" content="Sean Zhang" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Ray Tracing
<br />
<span class="subtitle">Notes on <i>Ray Tracing in One Weekend</i></span>
</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org5d531e9">1. Output An Image</a>
<ul>
<li><a href="#org9996737">1.1. PPM Image Format</a>
<ul>
<li><a href="#org4553153">1.1.1. Example</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org84f6b2d">2. Vec3 Class</a>
<ul>
<li><a href="#org5e6b550">2.1. Vec3.h</a></li>
<li><a href="#org686ed0f">2.2. color.h</a></li>
<li><a href="#org111b7e5">2.3. Revisiting Example 1.1.1</a></li>
</ul>
</li>
<li><a href="#org79378bb">3. Rays</a>
<ul>
<li><a href="#org5c9ad58">3.1. Ray Class</a></li>
<li><a href="#org79bcfe5">3.2. Sending Rays into Scene</a></li>
<li><a href="#org224a8f9">3.3. Example: Rendering a blue-to-white gradient, using Ray Tracing</a></li>
</ul>
</li>
<li><a href="#orgbe4c3ea">4. Adding a sphere to the scene</a>
<ul>
<li><a href="#orgd137b50">4.1. Hit detection</a>
<ul>
<li><a href="#orgbf5716f">4.1.1. Expressing as vectors</a></li>
<li><a href="#org340060b">4.1.2. Detecting if rays hit sphere</a></li>
<li><a href="#orga8a021d">4.1.3. Example: Adding the shape to our gradient</a></li>
</ul>
</li>
<li><a href="#org18fdaac">4.2. Surface Normals</a>
<ul>
<li><a href="#orgf076868">4.2.1. Example: Visualizing The Normal</a></li>
</ul>
</li>
<li><a href="#org02d685a">4.3. Simplifying the intersection code.</a></li>
<li><a href="#orgd5374e9">4.4. Abstraction to hittable objects</a>
<ul>
<li><a href="#org3f22384">4.4.1. Front Faces vs Back Faces</a></li>
<li><a href="#orgb2b55f6">4.4.2. A List of Hittable Objects</a></li>
<li><a href="#org6bbf06c">4.4.3. Wrapping Up With a Revised Example</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org0816dac">5. Antialiasing</a>
<ul>
<li><a href="#org8958a20">5.1. Random Number Generation</a></li>
<li><a href="#orge6fbab3">5.2. Abstracting the Camera</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org5d531e9" class="outline-2">
<h2 id="org5d531e9"><span class="section-number-2">1.</span> Output An Image</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org9996737" class="outline-3">
<h3 id="org9996737"><span class="section-number-3">1.1.</span> PPM Image Format</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Usually it details some sort of encoding - <code>P3</code> being colors in ASCII.
Then new line followed by <code>Num Cols</code> space, <code>Num Rows</code>.
The next line is a single number detailing the scale (<code>255</code> usually denotes max color).
Then <code>R G B</code> space separated values times the number of columns per row.
Then you have <code>Num Rows</code> rows to get you the final image.
</p>
</div>

<div id="outline-container-org4553153" class="outline-4">
<h4 id="org4553153"><span class="section-number-4">1.1.1.</span> Example</h4>
<div class="outline-text-4" id="text-1-1-1">
<p>
<b>Source:</b>
</p>
<div class="org-src-container">
<pre class="src src-C++" id="org03f5d1f"><span style="color: #a0132f;">#include</span> <span style="color: #2544bb;">&lt;iostream&gt;</span>
<span style="color: #5317ac;">using</span> <span style="color: #5317ac;">namespace</span> std<span style="color: #000000; background-color: #ffffff;">;</span>

<span style="color: #8f0075;">int</span> <span style="color: #721045;">main</span><span style="color: #000000; background-color: #ffffff;">()</span> <span style="color: #000000; background-color: #ffffff;">{</span>
    <span style="color: #5317ac;">const</span> <span style="color: #8f0075;">int</span> <span style="color: #00538b;">image_width</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">256</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #5317ac;">const</span> <span style="color: #8f0075;">int</span> <span style="color: #00538b;">image_height</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">256</span><span style="color: #000000; background-color: #ffffff;">;</span>

    cout <span style="color: #5317ac;">&lt;&lt;</span> <span style="color: #2544bb;">"P3"</span> <span style="color: #5317ac;">&lt;&lt;</span> endl <span style="color: #5317ac;">&lt;&lt;</span> image_width <span style="color: #5317ac;">&lt;&lt;</span> <span style="color: #2544bb;">" "</span> <span style="color: #5317ac;">&lt;&lt;</span> image_height <span style="color: #5317ac;">&lt;&lt;</span> endl
              <span style="color: #5317ac;">&lt;&lt;</span> <span style="color: #2544bb;">"255"</span> <span style="color: #5317ac;">&lt;&lt;</span> endl<span style="color: #000000; background-color: #ffffff;">;</span>

    <span style="color: #5317ac;">for</span> <span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #8f0075;">int</span> <span style="color: #00538b;">j</span> <span style="color: #5317ac;">=</span> image_height <span style="color: #5317ac;">-</span> <span style="color: #0000c0;">1</span><span style="color: #000000; background-color: #ffffff;">;</span> j <span style="color: #5317ac;">&gt;=</span> <span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">;</span> <span style="color: #5317ac;">--</span><span style="color: #00538b;">j</span><span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #a8007f; background-color: #ffffff;">{</span>
        <span style="color: #5317ac;">for</span> <span style="color: #005f88; background-color: #ffffff;">(</span><span style="color: #8f0075;">int</span> <span style="color: #00538b;">i</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">;</span> i <span style="color: #5317ac;">&lt;</span> image_width<span style="color: #000000; background-color: #ffffff;">;</span> <span style="color: #5317ac;">++</span><span style="color: #00538b;">i</span><span style="color: #005f88; background-color: #ffffff;">)</span> <span style="color: #005f88; background-color: #ffffff;">{</span>
             <span style="color: #005a5f;">auto</span> <span style="color: #00538b;">r</span> <span style="color: #5317ac;">=</span> <span style="color: #8f0075;">double</span><span style="color: #904200; background-color: #ffffff;">(</span>i<span style="color: #904200; background-color: #ffffff;">)</span> <span style="color: #5317ac;">/</span> <span style="color: #904200; background-color: #ffffff;">(</span>image_width <span style="color: #5317ac;">-</span> <span style="color: #0000c0;">1</span><span style="color: #904200; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
             <span style="color: #005a5f;">auto</span> <span style="color: #00538b;">g</span> <span style="color: #5317ac;">=</span> <span style="color: #8f0075;">double</span><span style="color: #904200; background-color: #ffffff;">(</span>j<span style="color: #904200; background-color: #ffffff;">)</span> <span style="color: #5317ac;">/</span> <span style="color: #904200; background-color: #ffffff;">(</span>image_height <span style="color: #5317ac;">-</span> <span style="color: #0000c0;">1</span><span style="color: #904200; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
             <span style="color: #005a5f;">auto</span> <span style="color: #00538b;">b</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">0.25</span><span style="color: #000000; background-color: #ffffff;">;</span>

             <span style="color: #8f0075;">int</span> <span style="color: #00538b;">ir</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">static_cast</span><span style="color: #904200;">&lt;</span><span style="color: #8f0075;">int</span><span style="color: #904200;">&gt;</span><span style="color: #904200; background-color: #ffffff;">(</span><span style="color: #0000c0;">255.999</span> <span style="color: #5317ac;">*</span> r<span style="color: #904200; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
             <span style="color: #8f0075;">int</span> <span style="color: #00538b;">ig</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">static_cast</span><span style="color: #904200;">&lt;</span><span style="color: #8f0075;">int</span><span style="color: #904200;">&gt;</span><span style="color: #904200; background-color: #ffffff;">(</span><span style="color: #0000c0;">255.999</span> <span style="color: #5317ac;">*</span> g<span style="color: #904200; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
             <span style="color: #8f0075;">int</span> <span style="color: #00538b;">ib</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">static_cast</span><span style="color: #904200;">&lt;</span><span style="color: #8f0075;">int</span><span style="color: #904200;">&gt;</span><span style="color: #904200; background-color: #ffffff;">(</span><span style="color: #0000c0;">255.999</span> <span style="color: #5317ac;">*</span> b<span style="color: #904200; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>

             <span style="color: #505050;">// for each pixel</span>
             cout <span style="color: #5317ac;">&lt;&lt;</span> ir <span style="color: #5317ac;">&lt;&lt;</span> <span style="color: #2544bb;">" "</span> <span style="color: #5317ac;">&lt;&lt;</span> ig <span style="color: #5317ac;">&lt;&lt;</span> <span style="color: #2544bb;">" "</span> <span style="color: #5317ac;">&lt;&lt;</span> ib <span style="color: #5317ac;">&lt;&lt;</span> endl<span style="color: #000000; background-color: #ffffff;">;</span>
        <span style="color: #005f88; background-color: #ffffff;">}</span>
    <span style="color: #a8007f; background-color: #ffffff;">}</span>
<span style="color: #000000; background-color: #ffffff;">}</span>
</pre>
</div>

<p>
<b>Output:</b>
</p>

<div id="org5e02951" class="figure">
<p><img src="./images/gradient.png" alt="gradient.png" />
</p>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org84f6b2d" class="outline-2">
<h2 id="org84f6b2d"><span class="section-number-2">2.</span> Vec3 Class</h2>
<div class="outline-text-2" id="text-2">
<p>
A 3D vector class that's used for:
</p>
<ul class="org-ul">
<li>Colors</li>
<li>Locations</li>
<li>Directions</li>
<li>Offsets</li>
<li>etc.</li>
</ul>
<p>
There will be two aliases created for vec3: point3 and color.
This is just used to clarify intent and use.
</p>
</div>

<div id="outline-container-org5e6b550" class="outline-3">
<h3 id="org5e6b550"><span class="section-number-3">2.1.</span> Vec3.h</h3>
<div class="outline-text-3" id="text-2-1">
<p>
<b>Code for Vec3: <code>vec3.h</code></b>
</p>

<p>
Note: This is just for showing. The code is stored as a file <a href="./util/vec3.h">here</a>.
</p>
<div class="org-src-container">
<pre class="src src-C++" id="orge647083">  <span style="color: #a0132f;">#ifndef</span> <span style="color: #0000c0;">VEC3_H</span>
  <span style="color: #a0132f;">#define</span> <span style="color: #702f00;">VEC3_H</span>

  #include &lt;iostream&gt;

  <span style="color: #5317ac;">class</span> <span style="color: #005a5f;">vec3</span> <span style="color: #000000; background-color: #ffffff;">{</span>
      <span style="color: #5317ac;">public</span>:
           <span style="color: #721045;">vec3</span><span style="color: #a8007f; background-color: #ffffff;">()</span> : <span style="color: #0000c0; font-style: italic;">e</span><span style="color: #a8007f; background-color: #ffffff;">{</span><span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0</span><span style="color: #a8007f; background-color: #ffffff;">}</span> <span style="color: #a8007f; background-color: #ffffff;">{}</span>
           <span style="color: #721045;">vec3</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #8f0075;">double</span> <span style="color: #00538b;">e0</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #8f0075;">double</span> <span style="color: #00538b;">e1</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #8f0075;">double</span> <span style="color: #00538b;">e2</span><span style="color: #a8007f; background-color: #ffffff;">)</span> : <span style="color: #0000c0; font-style: italic;">e</span><span style="color: #a8007f; background-color: #ffffff;">{</span>e0<span style="color: #000000; background-color: #ffffff;">,</span> e1<span style="color: #000000; background-color: #ffffff;">,</span> e2<span style="color: #a8007f; background-color: #ffffff;">}</span> <span style="color: #a8007f; background-color: #ffffff;">{}</span>
           <span style="color: #505050;">// getter methods</span>
           <span style="color: #8f0075;">double</span> <span style="color: #721045; font-style: italic;">x</span><span style="color: #a8007f; background-color: #ffffff;">()</span> <span style="color: #5317ac;">const</span> <span style="color: #a8007f; background-color: #ffffff;">{</span><span style="color: #5317ac;">return</span> e<span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">0</span><span style="color: #005f88; background-color: #ffffff;">]</span><span style="color: #a8007f; background-color: #ffffff;">}</span>
           <span style="color: #8f0075;">double</span> <span style="color: #721045; font-style: italic;">y</span><span style="color: #a8007f; background-color: #ffffff;">()</span> <span style="color: #5317ac;">const</span> <span style="color: #a8007f; background-color: #ffffff;">{</span><span style="color: #5317ac;">return</span> e<span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">1</span><span style="color: #005f88; background-color: #ffffff;">]</span><span style="color: #a8007f; background-color: #ffffff;">}</span>
           <span style="color: #8f0075;">double</span> <span style="color: #721045; font-style: italic;">z</span><span style="color: #a8007f; background-color: #ffffff;">()</span> <span style="color: #5317ac;">const</span> <span style="color: #a8007f; background-color: #ffffff;">{</span><span style="color: #5317ac;">return</span> e<span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">2</span><span style="color: #005f88; background-color: #ffffff;">]</span><span style="color: #a8007f; background-color: #ffffff;">}</span>

           <span style="color: #005a5f;">vec3</span> operator<span style="color: #5317ac;">-</span><span style="color: #a8007f; background-color: #ffffff;">()</span> <span style="color: #5317ac;">const</span> <span style="color: #a8007f; background-color: #ffffff;">{</span> <span style="color: #5317ac;">return</span> <span style="color: #0000c0;">vec3</span><span style="color: #005f88; background-color: #ffffff;">(</span><span style="color: #5317ac;">-</span>e<span style="color: #904200; background-color: #ffffff;">[</span><span style="color: #0000c0;">0</span><span style="color: #904200; background-color: #ffffff;">]</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #5317ac;">-</span>e<span style="color: #904200; background-color: #ffffff;">[</span><span style="color: #0000c0;">1</span><span style="color: #904200; background-color: #ffffff;">]</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #5317ac;">-</span>e<span style="color: #904200; background-color: #ffffff;">[</span><span style="color: #0000c0;">2</span><span style="color: #904200; background-color: #ffffff;">]</span><span style="color: #005f88; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span> <span style="color: #a8007f; background-color: #ffffff;">}</span>
           <span style="color: #8f0075;">double</span> operator<span style="color: #a8007f;">[]</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #8f0075;">int</span> <span style="color: #00538b;">i</span><span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #5317ac;">const</span> <span style="color: #a8007f; background-color: #ffffff;">{</span><span style="color: #5317ac;">return</span> e<span style="color: #005f88; background-color: #ffffff;">[</span>i<span style="color: #005f88; background-color: #ffffff;">]</span><span style="color: #000000; background-color: #ffffff;">;</span> <span style="color: #a8007f; background-color: #ffffff;">}</span>
           <span style="color: #8f0075;">double</span><span style="color: #5317ac;">&amp;</span> operator<span style="color: #a8007f;">[]</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #8f0075;">int</span> <span style="color: #00538b;">i</span><span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #a8007f; background-color: #ffffff;">{</span><span style="color: #5317ac;">return</span> e<span style="color: #005f88; background-color: #ffffff;">[</span>i<span style="color: #005f88; background-color: #ffffff;">]</span><span style="color: #000000; background-color: #ffffff;">;</span> <span style="color: #a8007f; background-color: #ffffff;">}</span>

           <span style="color: #505050;">// adding</span>
           <span style="color: #005a5f;">vec3</span> operator<span style="color: #5317ac;">+=</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #5317ac;">const</span> <span style="color: #005a5f;">vec3</span> <span style="color: #5317ac;">&amp;</span><span style="color: #00538b;">v</span><span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #a8007f; background-color: #ffffff;">{</span>
               <span style="color: #5317ac;">for</span> <span style="color: #005f88; background-color: #ffffff;">(</span><span style="color: #8f0075;">int</span> <span style="color: #00538b;">i</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">;</span> i <span style="color: #5317ac;">&lt;</span> <span style="color: #0000c0;">3</span><span style="color: #000000; background-color: #ffffff;">;</span> <span style="color: #5317ac;">++</span><span style="color: #00538b;">i</span><span style="color: #005f88; background-color: #ffffff;">)</span> <span style="color: #005f88; background-color: #ffffff;">{</span>
                   <span style="color: #00538b;">e</span><span style="color: #904200; background-color: #ffffff;">[</span>i<span style="color: #904200; background-color: #ffffff;">]</span> <span style="color: #5317ac;">+=</span> v<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #904200; background-color: #ffffff;">[</span>i<span style="color: #904200; background-color: #ffffff;">]</span><span style="color: #000000; background-color: #ffffff;">;</span>
               <span style="color: #005f88; background-color: #ffffff;">}</span>
               <span style="color: #5317ac;">return</span> <span style="color: #5317ac;">*</span><span style="color: #8f0075;">this</span><span style="color: #000000; background-color: #ffffff;">;</span>
           <span style="color: #a8007f; background-color: #ffffff;">}</span>
           <span style="color: #505050;">// scalar multiplication</span>
           <span style="color: #005a5f;">vec3</span><span style="color: #5317ac;">&amp;</span> operator<span style="color: #5317ac;">*=</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #5317ac;">const</span> <span style="color: #8f0075;">double</span> <span style="color: #00538b;">t</span><span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #a8007f; background-color: #ffffff;">{</span>
               <span style="color: #5317ac;">for</span> <span style="color: #005f88; background-color: #ffffff;">(</span><span style="color: #8f0075;">int</span> <span style="color: #00538b;">i</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">;</span> i <span style="color: #5317ac;">&lt;</span> <span style="color: #0000c0;">3</span><span style="color: #000000; background-color: #ffffff;">;</span> <span style="color: #5317ac;">++</span><span style="color: #00538b;">i</span><span style="color: #005f88; background-color: #ffffff;">)</span> <span style="color: #005f88; background-color: #ffffff;">{</span>
                   <span style="color: #00538b;">e</span><span style="color: #904200; background-color: #ffffff;">[</span>i<span style="color: #904200; background-color: #ffffff;">]</span> <span style="color: #5317ac;">*=</span> t<span style="color: #000000; background-color: #ffffff;">;</span>
               <span style="color: #005f88; background-color: #ffffff;">}</span>
               <span style="color: #5317ac;">return</span> <span style="color: #5317ac;">*</span><span style="color: #8f0075;">this</span><span style="color: #000000; background-color: #ffffff;">;</span>
           <span style="color: #a8007f; background-color: #ffffff;">}</span>

           <span style="color: #505050;">// scalar division</span>
           <span style="color: #005a5f;">vec3</span><span style="color: #5317ac;">&amp;</span> operator<span style="color: #5317ac;">/=</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #5317ac;">const</span> <span style="color: #8f0075;">double</span> <span style="color: #00538b;">t</span><span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #a8007f; background-color: #ffffff;">{</span>
               <span style="color: #5317ac;">return</span> <span style="color: #5317ac;">*</span><span style="color: #8f0075;">this</span> <span style="color: #5317ac;">*=</span> <span style="color: #0000c0;">1</span><span style="color: #5317ac;">/</span>t<span style="color: #000000; background-color: #ffffff;">;</span>
           <span style="color: #a8007f; background-color: #ffffff;">}</span>

           <span style="color: #8f0075;">double</span> <span style="color: #721045; font-style: italic;">length</span><span style="color: #a8007f; background-color: #ffffff;">()</span> <span style="color: #5317ac;">const</span> <span style="color: #a8007f; background-color: #ffffff;">{</span>
               <span style="color: #505050;">// return std::sqrt(length_squared());</span>
               <span style="color: #5317ac;">return</span> <span style="color: #0000c0;">1.0</span><span style="color: #000000; background-color: #ffffff;">;</span>
           <span style="color: #a8007f; background-color: #ffffff;">}</span>

           <span style="color: #8f0075;">double</span> <span style="color: #721045; font-style: italic;">length_squared</span><span style="color: #a8007f; background-color: #ffffff;">()</span> <span style="color: #5317ac;">const</span> <span style="color: #a8007f; background-color: #ffffff;">{</span>
               <span style="color: #5317ac;">return</span> e<span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">0</span><span style="color: #005f88; background-color: #ffffff;">]</span><span style="color: #5317ac;">*</span>e<span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">0</span><span style="color: #005f88; background-color: #ffffff;">]</span> <span style="color: #5317ac;">+</span> e<span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">1</span><span style="color: #005f88; background-color: #ffffff;">]</span><span style="color: #5317ac;">*</span>e<span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">1</span><span style="color: #005f88; background-color: #ffffff;">]</span> <span style="color: #5317ac;">+</span> e<span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">2</span><span style="color: #005f88; background-color: #ffffff;">]</span><span style="color: #5317ac;">*</span>e<span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">2</span><span style="color: #005f88; background-color: #ffffff;">]</span><span style="color: #000000; background-color: #ffffff;">;</span>
           <span style="color: #a8007f; background-color: #ffffff;">}</span>
       <span style="color: #5317ac;">public</span>:
           <span style="color: #8f0075;">double</span> <span style="color: #0000c0; font-style: italic;">e</span><span style="color: #a8007f; background-color: #ffffff;">[</span><span style="color: #0000c0;">3</span><span style="color: #a8007f; background-color: #ffffff;">]</span><span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #000000; background-color: #ffffff;">}</span><span style="color: #000000; background-color: #ffffff;">;</span>

  <span style="color: #505050;">// Type aliases for vec3</span>
<span style="color: #5317ac;">using</span> <span style="color: #005a5f;">point3</span> <span style="color: #5317ac;">=</span> <span style="color: #005a5f;">vec3</span><span style="color: #000000; background-color: #ffffff;">;</span> <span style="color: #505050;">// used for 3D points</span>
<span style="color: #5317ac;">using</span> <span style="color: #005a5f;">color</span> <span style="color: #5317ac;">=</span> <span style="color: #005a5f;">vec3</span><span style="color: #000000; background-color: #ffffff;">;</span>  <span style="color: #505050;">// used for RGB color</span>

<span style="color: #505050;">// vec3 Utility Functions</span>

<span style="color: #5317ac;">inline</span> <span style="color: #005a5f;">std</span>::<span style="color: #005a5f;">ostream</span><span style="color: #5317ac;">&amp;</span> operator<span style="color: #5317ac;">&lt;&lt;</span><span style="color: #000000; background-color: #ffffff;">(</span><span style="color: #005a5f;">std</span>::<span style="color: #005a5f;">ostream</span> <span style="color: #5317ac;">&amp;</span><span style="color: #00538b;">out</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #5317ac;">const</span> <span style="color: #005a5f;">vec3</span> <span style="color: #5317ac;">&amp;</span><span style="color: #00538b;">v</span><span style="color: #000000; background-color: #ffffff;">)</span> <span style="color: #000000; background-color: #ffffff;">{</span>
    <span style="color: #5317ac;">return</span> out <span style="color: #5317ac;">&lt;&lt;</span> v<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #a8007f; background-color: #ffffff;">[</span><span style="color: #0000c0;">0</span><span style="color: #a8007f; background-color: #ffffff;">]</span> <span style="color: #5317ac;">&lt;&lt;</span> <span style="color: #0000c0;">' '</span> <span style="color: #5317ac;">&lt;&lt;</span> v<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #a8007f; background-color: #ffffff;">[</span><span style="color: #0000c0;">1</span><span style="color: #a8007f; background-color: #ffffff;">]</span> <span style="color: #5317ac;">&lt;&lt;</span> <span style="color: #0000c0;">' '</span> <span style="color: #5317ac;">&lt;&lt;</span> v<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #a8007f; background-color: #ffffff;">[</span><span style="color: #0000c0;">2</span><span style="color: #a8007f; background-color: #ffffff;">]</span><span style="color: #000000; background-color: #ffffff;">;</span>
<span style="color: #000000; background-color: #ffffff;">}</span>

<span style="color: #5317ac;">inline</span> <span style="color: #005a5f;">vec3</span> operator<span style="color: #5317ac;">+</span><span style="color: #000000; background-color: #ffffff;">(</span><span style="color: #5317ac;">const</span> <span style="color: #005a5f;">vec3</span> <span style="color: #5317ac;">&amp;</span><span style="color: #00538b;">u</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #5317ac;">const</span> <span style="color: #005a5f;">vec3</span> <span style="color: #5317ac;">&amp;</span><span style="color: #00538b;">v</span><span style="color: #000000; background-color: #ffffff;">)</span> <span style="color: #000000; background-color: #ffffff;">{</span>
    <span style="color: #5317ac;">return</span> <span style="color: #0000c0;">vec3</span><span style="color: #a8007f; background-color: #ffffff;">(</span>u<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">0</span><span style="color: #005f88; background-color: #ffffff;">]</span> <span style="color: #5317ac;">+</span> v<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">0</span><span style="color: #005f88; background-color: #ffffff;">]</span><span style="color: #000000; background-color: #ffffff;">,</span> u<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">1</span><span style="color: #005f88; background-color: #ffffff;">]</span> <span style="color: #5317ac;">+</span> v<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">1</span><span style="color: #005f88; background-color: #ffffff;">]</span><span style="color: #000000; background-color: #ffffff;">,</span> u<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">2</span><span style="color: #005f88; background-color: #ffffff;">]</span> <span style="color: #5317ac;">+</span> v<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">2</span><span style="color: #005f88; background-color: #ffffff;">]</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
<span style="color: #000000; background-color: #ffffff;">}</span>

<span style="color: #5317ac;">inline</span> <span style="color: #005a5f;">vec3</span> operator<span style="color: #5317ac;">-</span><span style="color: #000000; background-color: #ffffff;">(</span><span style="color: #5317ac;">const</span> <span style="color: #005a5f;">vec3</span> <span style="color: #5317ac;">&amp;</span><span style="color: #00538b;">u</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #5317ac;">const</span> <span style="color: #005a5f;">vec3</span> <span style="color: #5317ac;">&amp;</span><span style="color: #00538b;">v</span><span style="color: #000000; background-color: #ffffff;">)</span> <span style="color: #000000; background-color: #ffffff;">{</span>
    <span style="color: #5317ac;">return</span> <span style="color: #0000c0;">vec3</span><span style="color: #a8007f; background-color: #ffffff;">(</span>u<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">0</span><span style="color: #005f88; background-color: #ffffff;">]</span> <span style="color: #5317ac;">-</span> v<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">0</span><span style="color: #005f88; background-color: #ffffff;">]</span><span style="color: #000000; background-color: #ffffff;">,</span> u<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">1</span><span style="color: #005f88; background-color: #ffffff;">]</span> <span style="color: #5317ac;">-</span> v<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">1</span><span style="color: #005f88; background-color: #ffffff;">]</span><span style="color: #000000; background-color: #ffffff;">,</span> u<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">2</span><span style="color: #005f88; background-color: #ffffff;">]</span> <span style="color: #5317ac;">-</span> v<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">2</span><span style="color: #005f88; background-color: #ffffff;">]</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
<span style="color: #000000; background-color: #ffffff;">}</span>

<span style="color: #5317ac;">inline</span> <span style="color: #005a5f;">vec3</span> operator<span style="color: #5317ac;">*</span><span style="color: #000000; background-color: #ffffff;">(</span><span style="color: #5317ac;">const</span> <span style="color: #005a5f;">vec3</span> <span style="color: #5317ac;">&amp;</span><span style="color: #00538b;">u</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #5317ac;">const</span> <span style="color: #005a5f;">vec3</span> <span style="color: #5317ac;">&amp;</span><span style="color: #00538b;">v</span><span style="color: #000000; background-color: #ffffff;">)</span> <span style="color: #000000; background-color: #ffffff;">{</span>
    <span style="color: #5317ac;">return</span> <span style="color: #0000c0;">vec3</span><span style="color: #a8007f; background-color: #ffffff;">(</span>u<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">0</span><span style="color: #005f88; background-color: #ffffff;">]</span> <span style="color: #5317ac;">*</span> v<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">0</span><span style="color: #005f88; background-color: #ffffff;">]</span><span style="color: #000000; background-color: #ffffff;">,</span> u<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">1</span><span style="color: #005f88; background-color: #ffffff;">]</span> <span style="color: #5317ac;">*</span> v<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">1</span><span style="color: #005f88; background-color: #ffffff;">]</span><span style="color: #000000; background-color: #ffffff;">,</span> u<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">2</span><span style="color: #005f88; background-color: #ffffff;">]</span> <span style="color: #5317ac;">*</span> v<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">2</span><span style="color: #005f88; background-color: #ffffff;">]</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
<span style="color: #000000; background-color: #ffffff;">}</span>

<span style="color: #5317ac;">inline</span> <span style="color: #005a5f;">vec3</span> operator<span style="color: #5317ac;">*</span><span style="color: #000000; background-color: #ffffff;">(</span><span style="color: #8f0075;">double</span> <span style="color: #00538b;">t</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #5317ac;">const</span> <span style="color: #005a5f;">vec3</span> <span style="color: #5317ac;">&amp;</span><span style="color: #00538b;">v</span><span style="color: #000000; background-color: #ffffff;">)</span> <span style="color: #000000; background-color: #ffffff;">{</span>
    <span style="color: #5317ac;">return</span> <span style="color: #0000c0;">vec3</span><span style="color: #a8007f; background-color: #ffffff;">(</span>t<span style="color: #5317ac;">*</span>v<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">0</span><span style="color: #005f88; background-color: #ffffff;">]</span><span style="color: #000000; background-color: #ffffff;">,</span> t<span style="color: #5317ac;">*</span>v<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">1</span><span style="color: #005f88; background-color: #ffffff;">]</span><span style="color: #000000; background-color: #ffffff;">,</span> t<span style="color: #5317ac;">*</span>v<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">2</span><span style="color: #005f88; background-color: #ffffff;">]</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
<span style="color: #000000; background-color: #ffffff;">}</span>

<span style="color: #5317ac;">inline</span> <span style="color: #005a5f;">vec3</span> operator<span style="color: #5317ac;">*</span><span style="color: #000000; background-color: #ffffff;">(</span><span style="color: #5317ac;">const</span> <span style="color: #005a5f;">vec3</span> <span style="color: #5317ac;">&amp;</span><span style="color: #00538b;">v</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #8f0075;">double</span> <span style="color: #00538b;">t</span><span style="color: #000000; background-color: #ffffff;">)</span> <span style="color: #000000; background-color: #ffffff;">{</span>
    <span style="color: #5317ac;">return</span> t <span style="color: #5317ac;">*</span> v<span style="color: #000000; background-color: #ffffff;">;</span>
<span style="color: #000000; background-color: #ffffff;">}</span>

<span style="color: #5317ac;">inline</span> <span style="color: #005a5f;">vec3</span> operator<span style="color: #5317ac;">/</span><span style="color: #000000; background-color: #ffffff;">(</span><span style="color: #005a5f;">vec3</span> <span style="color: #00538b;">v</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #8f0075;">double</span> <span style="color: #00538b;">t</span><span style="color: #000000; background-color: #ffffff;">)</span> <span style="color: #000000; background-color: #ffffff;">{</span>
    <span style="color: #5317ac;">return</span> <span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">1</span><span style="color: #5317ac;">/</span>t<span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #5317ac;">*</span> v<span style="color: #000000; background-color: #ffffff;">;</span>
<span style="color: #000000; background-color: #ffffff;">}</span>

<span style="color: #5317ac;">inline</span> <span style="color: #8f0075;">double</span> <span style="color: #721045;">dot</span><span style="color: #000000; background-color: #ffffff;">(</span><span style="color: #5317ac;">const</span> <span style="color: #005a5f;">vec3</span> <span style="color: #5317ac;">&amp;</span><span style="color: #00538b;">u</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #5317ac;">const</span> <span style="color: #005a5f;">vec3</span> <span style="color: #5317ac;">&amp;</span><span style="color: #00538b;">v</span><span style="color: #000000; background-color: #ffffff;">)</span> <span style="color: #000000; background-color: #ffffff;">{</span>
    <span style="color: #5317ac;">return</span> u<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #a8007f; background-color: #ffffff;">[</span><span style="color: #0000c0;">0</span><span style="color: #a8007f; background-color: #ffffff;">]</span> <span style="color: #5317ac;">*</span> v<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #a8007f; background-color: #ffffff;">[</span><span style="color: #0000c0;">0</span><span style="color: #a8007f; background-color: #ffffff;">]</span>
         <span style="color: #5317ac;">+</span> u<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #a8007f; background-color: #ffffff;">[</span><span style="color: #0000c0;">1</span><span style="color: #a8007f; background-color: #ffffff;">]</span> <span style="color: #5317ac;">*</span> v<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #a8007f; background-color: #ffffff;">[</span><span style="color: #0000c0;">1</span><span style="color: #a8007f; background-color: #ffffff;">]</span>
         <span style="color: #5317ac;">+</span> u<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #a8007f; background-color: #ffffff;">[</span><span style="color: #0000c0;">2</span><span style="color: #a8007f; background-color: #ffffff;">]</span> <span style="color: #5317ac;">*</span> v<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #a8007f; background-color: #ffffff;">[</span><span style="color: #0000c0;">2</span><span style="color: #a8007f; background-color: #ffffff;">]</span><span style="color: #000000; background-color: #ffffff;">;</span>
<span style="color: #000000; background-color: #ffffff;">}</span>

<span style="color: #5317ac;">inline</span> <span style="color: #005a5f;">vec3</span> <span style="color: #721045;">cross</span><span style="color: #000000; background-color: #ffffff;">(</span><span style="color: #5317ac;">const</span> <span style="color: #005a5f;">vec3</span> <span style="color: #5317ac;">&amp;</span><span style="color: #00538b;">u</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #5317ac;">const</span> <span style="color: #005a5f;">vec3</span> <span style="color: #5317ac;">&amp;</span><span style="color: #00538b;">v</span><span style="color: #000000; background-color: #ffffff;">)</span> <span style="color: #000000; background-color: #ffffff;">{</span>
    <span style="color: #5317ac;">return</span> <span style="color: #0000c0;">vec3</span><span style="color: #a8007f; background-color: #ffffff;">(</span>u<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">1</span><span style="color: #005f88; background-color: #ffffff;">]</span> <span style="color: #5317ac;">*</span> v<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">2</span><span style="color: #005f88; background-color: #ffffff;">]</span> <span style="color: #5317ac;">-</span> u<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">2</span><span style="color: #005f88; background-color: #ffffff;">]</span> <span style="color: #5317ac;">*</span> v<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">1</span><span style="color: #005f88; background-color: #ffffff;">]</span><span style="color: #000000; background-color: #ffffff;">,</span>
                u<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">2</span><span style="color: #005f88; background-color: #ffffff;">]</span> <span style="color: #5317ac;">*</span> v<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">0</span><span style="color: #005f88; background-color: #ffffff;">]</span> <span style="color: #5317ac;">-</span> u<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">0</span><span style="color: #005f88; background-color: #ffffff;">]</span> <span style="color: #5317ac;">*</span> v<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">2</span><span style="color: #005f88; background-color: #ffffff;">]</span><span style="color: #000000; background-color: #ffffff;">,</span>
                u<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">0</span><span style="color: #005f88; background-color: #ffffff;">]</span> <span style="color: #5317ac;">*</span> v<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">1</span><span style="color: #005f88; background-color: #ffffff;">]</span> <span style="color: #5317ac;">-</span> u<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">1</span><span style="color: #005f88; background-color: #ffffff;">]</span> <span style="color: #5317ac;">*</span> v<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">e</span><span style="color: #005f88; background-color: #ffffff;">[</span><span style="color: #0000c0;">0</span><span style="color: #005f88; background-color: #ffffff;">]</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
<span style="color: #000000; background-color: #ffffff;">}</span>

<span style="color: #5317ac;">inline</span> <span style="color: #005a5f;">vec3</span> <span style="color: #721045;">unit_vector</span><span style="color: #000000; background-color: #ffffff;">(</span><span style="color: #005a5f;">vec3</span> <span style="color: #00538b;">v</span><span style="color: #000000; background-color: #ffffff;">)</span> <span style="color: #000000; background-color: #ffffff;">{</span>
    <span style="color: #5317ac;">return</span> v <span style="color: #5317ac;">/</span> v<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">length</span><span style="color: #a8007f; background-color: #ffffff;">()</span><span style="color: #000000; background-color: #ffffff;">;</span>
<span style="color: #000000; background-color: #ffffff;">}</span>
  <span style="color: #a0132f;">#endif</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org686ed0f" class="outline-3">
<h3 id="org686ed0f"><span class="section-number-3">2.2.</span> color.h</h3>
<div class="outline-text-3" id="text-2-2">
<p>
<b>Code for Color Utility: <code>color.h</code></b>
</p>

<p>
Saved as a header <a href="./util/color.h">here</a>.
</p>
<div class="org-src-container">
<pre class="src src-C++" id="orgc8907d9"><span style="color: #a0132f;">#ifndef</span> <span style="color: #0000c0;">COLOR_H</span>
<span style="color: #a0132f;">#define</span> <span style="color: #702f00;">COLOR_H</span>

<span style="color: #a0132f;">#include</span> <span style="color: #2544bb;">"vec3.h"</span>
<span style="color: #a0132f;">#include</span> <span style="color: #2544bb;">&lt;iostream&gt;</span>

<span style="color: #8f0075;">void</span> <span style="color: #721045;">write_color</span><span style="color: #000000; background-color: #ffffff;">(</span><span style="color: #005a5f;">std</span>::<span style="color: #005a5f;">ostream</span> <span style="color: #5317ac;">&amp;</span><span style="color: #00538b;">out</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #005a5f;">color</span> <span style="color: #00538b;">pixel_color</span><span style="color: #000000; background-color: #ffffff;">)</span> <span style="color: #000000; background-color: #ffffff;">{</span>
  <span style="color: #505050;">// Write the translated [0,255] value of each color component.</span>
  out <span style="color: #5317ac;">&lt;&lt;</span> <span style="color: #0000c0;">static_cast</span><span style="color: #a8007f;">&lt;</span><span style="color: #8f0075;">int</span><span style="color: #a8007f;">&gt;</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">255.999</span> <span style="color: #5317ac;">*</span> pixel_color<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">x</span><span style="color: #005f88; background-color: #ffffff;">()</span><span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #5317ac;">&lt;&lt;</span> <span style="color: #0000c0;">' '</span>
      <span style="color: #5317ac;">&lt;&lt;</span> <span style="color: #0000c0;">static_cast</span><span style="color: #a8007f;">&lt;</span><span style="color: #8f0075;">int</span><span style="color: #a8007f;">&gt;</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">255.999</span> <span style="color: #5317ac;">*</span> pixel_color<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">y</span><span style="color: #005f88; background-color: #ffffff;">()</span><span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #5317ac;">&lt;&lt;</span> <span style="color: #0000c0;">' '</span>
      <span style="color: #5317ac;">&lt;&lt;</span> <span style="color: #0000c0;">static_cast</span><span style="color: #a8007f;">&lt;</span><span style="color: #8f0075;">int</span><span style="color: #a8007f;">&gt;</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">255.999</span> <span style="color: #5317ac;">*</span> pixel_color<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">z</span><span style="color: #005f88; background-color: #ffffff;">()</span><span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #5317ac;">&lt;&lt;</span> <span style="color: #0000c0;">'\n'</span><span style="color: #000000; background-color: #ffffff;">;</span>
<span style="color: #000000; background-color: #ffffff;">}</span>

<span style="color: #a0132f;">#endif</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org111b7e5" class="outline-3">
<h3 id="org111b7e5"><span class="section-number-3">2.3.</span> Revisiting Example 1.1.1</h3>
<div class="outline-text-3" id="text-2-3">
<p>
Update the old example but this time using the color class and using <code>write_color</code>. I also added
more blue hue to all the pixels.
</p>

<p>
<b>Source:</b> 
</p>
<div class="org-src-container">
<pre class="src src-C++" id="org62f2c83"><span style="color: #a0132f;">#include</span> <span style="color: #2544bb;">"util/color.h"</span>
<span style="color: #a0132f;">#include</span> <span style="color: #2544bb;">"util/vec3.h"</span>

<span style="color: #a0132f;">#include</span> <span style="color: #2544bb;">&lt;iostream&gt;</span>

<span style="color: #5317ac;">using</span> <span style="color: #5317ac;">namespace</span> std<span style="color: #000000; background-color: #ffffff;">;</span>

<span style="color: #8f0075;">int</span> <span style="color: #721045;">main</span><span style="color: #000000; background-color: #ffffff;">()</span> <span style="color: #000000; background-color: #ffffff;">{</span>
    <span style="color: #5317ac;">const</span> <span style="color: #8f0075;">int</span> <span style="color: #00538b;">image_width</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">256</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #5317ac;">const</span> <span style="color: #8f0075;">int</span> <span style="color: #00538b;">image_height</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">256</span><span style="color: #000000; background-color: #ffffff;">;</span>

    cout <span style="color: #5317ac;">&lt;&lt;</span> <span style="color: #2544bb;">"P3"</span> <span style="color: #5317ac;">&lt;&lt;</span> endl <span style="color: #5317ac;">&lt;&lt;</span> image_width <span style="color: #5317ac;">&lt;&lt;</span> <span style="color: #2544bb;">" "</span> <span style="color: #5317ac;">&lt;&lt;</span> image_height <span style="color: #5317ac;">&lt;&lt;</span> endl
              <span style="color: #5317ac;">&lt;&lt;</span> <span style="color: #2544bb;">"255"</span> <span style="color: #5317ac;">&lt;&lt;</span> endl<span style="color: #000000; background-color: #ffffff;">;</span>

    <span style="color: #5317ac;">for</span> <span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #8f0075;">int</span> <span style="color: #00538b;">j</span> <span style="color: #5317ac;">=</span> image_height <span style="color: #5317ac;">-</span> <span style="color: #0000c0;">1</span><span style="color: #000000; background-color: #ffffff;">;</span> j <span style="color: #5317ac;">&gt;=</span> <span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">;</span> <span style="color: #5317ac;">--</span><span style="color: #00538b;">j</span><span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #a8007f; background-color: #ffffff;">{</span>
        <span style="color: #5317ac;">for</span> <span style="color: #005f88; background-color: #ffffff;">(</span><span style="color: #8f0075;">int</span> <span style="color: #00538b;">i</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">;</span> i <span style="color: #5317ac;">&lt;</span> image_width<span style="color: #000000; background-color: #ffffff;">;</span> <span style="color: #5317ac;">++</span><span style="color: #00538b;">i</span><span style="color: #005f88; background-color: #ffffff;">)</span> <span style="color: #005f88; background-color: #ffffff;">{</span>
             <span style="color: #005a5f;">color</span> <span style="color: #00538b;">pixel</span><span style="color: #904200; background-color: #ffffff;">(</span><span style="color: #8f0075;">double</span><span style="color: #7f10d0; background-color: #ffffff;">(</span>i<span style="color: #7f10d0; background-color: #ffffff;">)</span> <span style="color: #5317ac;">/</span> <span style="color: #7f10d0; background-color: #ffffff;">(</span>image_width <span style="color: #5317ac;">-</span> <span style="color: #0000c0;">1</span><span style="color: #7f10d0; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">,</span>
                         <span style="color: #8f0075;">double</span><span style="color: #7f10d0; background-color: #ffffff;">(</span>j<span style="color: #7f10d0; background-color: #ffffff;">)</span> <span style="color: #5317ac;">/</span> <span style="color: #7f10d0; background-color: #ffffff;">(</span>image_height <span style="color: #5317ac;">-</span> <span style="color: #0000c0;">1</span><span style="color: #7f10d0; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0.85</span><span style="color: #904200; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
             <span style="color: #0000c0;">write_color</span><span style="color: #904200; background-color: #ffffff;">(</span><span style="color: #005a5f;">std</span>::cout<span style="color: #000000; background-color: #ffffff;">,</span> pixel<span style="color: #904200; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
        <span style="color: #005f88; background-color: #ffffff;">}</span>
    <span style="color: #a8007f; background-color: #ffffff;">}</span>
<span style="color: #000000; background-color: #ffffff;">}</span>
</pre>
</div>

<p>
<b>Output:</b>
</p>

<div id="org4c4a5db" class="figure">
<p><img src="./images/gradient-mod.png" alt="gradient-mod.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org79378bb" class="outline-2">
<h2 id="org79378bb"><span class="section-number-2">3.</span> Rays</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org5c9ad58" class="outline-3">
<h3 id="org5c9ad58"><span class="section-number-3">3.1.</span> Ray Class</h3>
<div class="outline-text-3" id="text-3-1">
<p>
A ray is a function, \(P(t) = A + tb\), \(t \in \mathbb{R}\). A is the ray origin, and b is the ray vector.
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #a0132f;">#ifndef</span> <span style="color: #0000c0;">RAY_H</span>
<span style="color: #a0132f;">#define</span> <span style="color: #702f00;">RAY_H</span>

<span style="color: #a0132f;">#include</span> <span style="color: #2544bb;">"vec3.h"</span>

<span style="color: #5317ac;">class</span> <span style="color: #005a5f;">ray</span> <span style="color: #000000; background-color: #ffffff;">{</span>
    <span style="color: #5317ac;">public</span>:
        <span style="color: #721045;">ray</span><span style="color: #a8007f; background-color: #ffffff;">()</span> <span style="color: #a8007f; background-color: #ffffff;">{}</span>
        <span style="color: #721045;">ray</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #5317ac;">const</span> <span style="color: #005a5f;">point3</span><span style="color: #5317ac;">&amp;</span> <span style="color: #00538b;">origin</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #5317ac;">const</span> <span style="color: #005a5f;">vec3</span><span style="color: #5317ac;">&amp;</span> <span style="color: #00538b;">direction</span><span style="color: #a8007f; background-color: #ffffff;">)</span>
            : <span style="color: #0000c0; font-style: italic;">orig</span><span style="color: #a8007f; background-color: #ffffff;">(</span>origin<span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0; font-style: italic;">dir</span><span style="color: #a8007f; background-color: #ffffff;">(</span>direction<span style="color: #a8007f; background-color: #ffffff;">)</span>
        <span style="color: #a8007f; background-color: #ffffff;">{}</span>

        <span style="color: #005a5f;">point3</span> <span style="color: #721045; font-style: italic;">origin</span><span style="color: #a8007f; background-color: #ffffff;">()</span> <span style="color: #5317ac;">const</span>  <span style="color: #a8007f; background-color: #ffffff;">{</span> <span style="color: #5317ac;">return</span> orig<span style="color: #000000; background-color: #ffffff;">;</span> <span style="color: #a8007f; background-color: #ffffff;">}</span>
        <span style="color: #005a5f;">vec3</span> <span style="color: #721045; font-style: italic;">direction</span><span style="color: #a8007f; background-color: #ffffff;">()</span> <span style="color: #5317ac;">const</span> <span style="color: #a8007f; background-color: #ffffff;">{</span> <span style="color: #5317ac;">return</span> dir<span style="color: #000000; background-color: #ffffff;">;</span> <span style="color: #a8007f; background-color: #ffffff;">}</span>

        <span style="color: #005a5f;">point3</span> <span style="color: #721045; font-style: italic;">at</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #8f0075;">double</span> <span style="color: #00538b;">t</span><span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #5317ac;">const</span> <span style="color: #a8007f; background-color: #ffffff;">{</span>
            <span style="color: #5317ac;">return</span> orig <span style="color: #5317ac;">+</span> t<span style="color: #5317ac;">*</span>dir<span style="color: #000000; background-color: #ffffff;">;</span>
        <span style="color: #a8007f; background-color: #ffffff;">}</span>

    <span style="color: #5317ac;">public</span>:
        <span style="color: #005a5f;">point3</span> <span style="color: #00538b; font-style: italic;">orig</span><span style="color: #000000; background-color: #ffffff;">;</span>
        <span style="color: #005a5f;">vec3</span> <span style="color: #00538b; font-style: italic;">dir</span><span style="color: #000000; background-color: #ffffff;">;</span>
<span style="color: #000000; background-color: #ffffff;">}</span><span style="color: #000000; background-color: #ffffff;">;</span>

<span style="color: #a0132f;">#endif</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org79bcfe5" class="outline-3">
<h3 id="org79bcfe5"><span class="section-number-3">3.2.</span> Sending Rays into Scene</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Its time to ray trace! The ray tracer sends rays through pixels and
computes the color seen in the direction of those rays.
</p>

<p>
Here are the steps:
</p>
<ol class="org-ol">
<li>Calculate the ray from the eye to the pixel.</li>
<li>Determine which objects the ray intersects.</li>
<li>Computer a color for that intersection point.</li>
</ol>

<p>
Some parameters we need:
</p>
<ul class="org-ul">
<li>Aspect ratio</li>
<li>Focal length
This is the distance from the eye to the projection plane.??
IDK what this is, but its a plane in the back</li>
<li>Eye/Camera
This will be at the origin.</li>
</ul>

<p>
The y axis will be up, x axis to the right, and z axis moving backwards,
because hand rules.
</p>
</div>
</div>

<div id="outline-container-org224a8f9" class="outline-3">
<h3 id="org224a8f9"><span class="section-number-3">3.3.</span> Example: Rendering a blue-to-white gradient, using Ray Tracing</h3>
<div class="outline-text-3" id="text-3-3">
<p>
<b>Source</b>
</p>
<div class="org-src-container">
<pre class="src src-C++" id="orgcc27485">  <span style="color: #a0132f;">#include</span> <span style="color: #2544bb;">"util/color.h"</span>
  <span style="color: #a0132f;">#include</span> <span style="color: #2544bb;">"util/ray.h"</span>
  <span style="color: #a0132f;">#include</span> <span style="color: #2544bb;">"util/vec3.h"</span>

  <span style="color: #a0132f;">#include</span> <span style="color: #2544bb;">&lt;iostream&gt;</span>

  <span style="color: #505050;">// this function returns a color for which ray its on.</span>
  <span style="color: #005a5f;">color</span> <span style="color: #721045;">ray_color</span><span style="color: #000000; background-color: #ffffff;">(</span><span style="color: #5317ac;">const</span> <span style="color: #005a5f;">ray</span><span style="color: #5317ac;">&amp;</span> <span style="color: #00538b;">r</span><span style="color: #000000; background-color: #ffffff;">)</span> <span style="color: #000000; background-color: #ffffff;">{</span>
    <span style="color: #005a5f;">vec3</span> <span style="color: #00538b;">unit_direction</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">unit_vector</span><span style="color: #a8007f; background-color: #ffffff;">(</span>r<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">direction</span><span style="color: #005f88; background-color: #ffffff;">()</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #505050;">// this is to try and put the pixel in the center y</span>
    <span style="color: #005a5f;">auto</span> <span style="color: #00538b;">t</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">0.5</span> <span style="color: #5317ac;">*</span> <span style="color: #a8007f; background-color: #ffffff;">(</span>unit_direction<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">y</span><span style="color: #005f88; background-color: #ffffff;">()</span> <span style="color: #5317ac;">+</span> <span style="color: #0000c0;">1.0</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span> 
    <span style="color: #505050;">// the gradient color (blue-white) depends on where the</span>
    <span style="color: #505050;">// y-value sits.</span>
    <span style="color: #505050;">// higher y values -&gt; more blue</span>
    <span style="color: #5317ac;">return</span> t <span style="color: #5317ac;">*</span> <span style="color: #0000c0;">color</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">0.5</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0.7</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">1.0</span><span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #5317ac;">+</span> <span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">1</span> <span style="color: #5317ac;">-</span> t<span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #5317ac;">*</span> <span style="color: #0000c0;">color</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">1.0</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">1.0</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">1.0</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #000000; background-color: #ffffff;">}</span>

  <span style="color: #8f0075;">int</span> <span style="color: #721045;">main</span><span style="color: #000000; background-color: #ffffff;">()</span> <span style="color: #000000; background-color: #ffffff;">{</span>

    <span style="color: #505050;">// image</span>
    <span style="color: #8f0075;">double</span> <span style="color: #00538b;">aspect</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">16.0</span> <span style="color: #5317ac;">/</span> <span style="color: #0000c0;">9.0</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #8f0075;">int</span> <span style="color: #00538b;">height</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">200</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #8f0075;">int</span> <span style="color: #00538b;">width</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">static_cast</span><span style="color: #a8007f;">&lt;</span><span style="color: #8f0075;">int</span><span style="color: #a8007f;">&gt;</span><span style="color: #a8007f; background-color: #ffffff;">(</span>height <span style="color: #5317ac;">*</span> aspect<span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>

    <span style="color: #505050;">// camera setup</span>

    <span style="color: #8f0075;">double</span> <span style="color: #00538b;">viewport_height</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">2.0</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #8f0075;">double</span> <span style="color: #00538b;">viewport_width</span> <span style="color: #5317ac;">=</span> viewport_height <span style="color: #5317ac;">*</span> aspect<span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #8f0075;">double</span> <span style="color: #00538b;">focal_length</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">1.0</span><span style="color: #000000; background-color: #ffffff;">;</span>

    <span style="color: #005a5f;">point3</span> <span style="color: #00538b;">origin</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">0.0</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0.0</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0.0</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #005a5f;">vec3</span> <span style="color: #00538b;">horizontal</span><span style="color: #a8007f; background-color: #ffffff;">(</span>viewport_width<span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0.0</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0.0</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #005a5f;">vec3</span> <span style="color: #00538b;">vertical</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">0.0</span><span style="color: #000000; background-color: #ffffff;">,</span> viewport_height<span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0.0</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #005a5f;">vec3</span> <span style="color: #00538b;">lower_left_corner</span> <span style="color: #5317ac;">=</span> origin <span style="color: #5317ac;">-</span> horizontal <span style="color: #5317ac;">/</span> <span style="color: #0000c0;">2</span> <span style="color: #5317ac;">-</span>
       vertical <span style="color: #5317ac;">/</span> <span style="color: #0000c0;">2</span> <span style="color: #5317ac;">-</span> <span style="color: #0000c0;">vec3</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">0.0</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0.0</span><span style="color: #000000; background-color: #ffffff;">,</span> focal_length<span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>

    <span style="color: #505050;">// Render</span>
    <span style="color: #005a5f;">std</span>::cout <span style="color: #5317ac;">&lt;&lt;</span> <span style="color: #2544bb;">"P3\n"</span> <span style="color: #5317ac;">&lt;&lt;</span> width <span style="color: #5317ac;">&lt;&lt;</span> <span style="color: #2544bb;">" "</span> <span style="color: #5317ac;">&lt;&lt;</span> height
              <span style="color: #5317ac;">&lt;&lt;</span> <span style="color: #2544bb;">"\n255"</span>  <span style="color: #5317ac;">&lt;&lt;</span> <span style="color: #005a5f;">std</span>::endl<span style="color: #000000; background-color: #ffffff;">;</span>

    <span style="color: #505050;">// loop</span>
    <span style="color: #5317ac;">for</span> <span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #8f0075;">int</span> <span style="color: #00538b;">j</span> <span style="color: #5317ac;">=</span> height<span style="color: #5317ac;">-</span><span style="color: #0000c0;">1</span><span style="color: #000000; background-color: #ffffff;">;</span> j <span style="color: #5317ac;">&gt;=</span> <span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">;</span> <span style="color: #5317ac;">--</span><span style="color: #00538b;">j</span><span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #a8007f; background-color: #ffffff;">{</span> <span style="color: #505050;">// explanation: scans pixels L-&gt;R U-&gt;D</span>
      <span style="color: #5317ac;">for</span> <span style="color: #005f88; background-color: #ffffff;">(</span><span style="color: #8f0075;">int</span> <span style="color: #00538b;">i</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">;</span> i <span style="color: #5317ac;">&lt;</span> width<span style="color: #000000; background-color: #ffffff;">;</span> <span style="color: #5317ac;">++</span><span style="color: #00538b;">i</span><span style="color: #005f88; background-color: #ffffff;">)</span> <span style="color: #005f88; background-color: #ffffff;">{</span> <span style="color: #505050;">// i thus needs to be in the inner loop</span>

          <span style="color: #005a5f;">ray</span> <span style="color: #00538b;">r</span><span style="color: #904200; background-color: #ffffff;">(</span>origin<span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">vec3</span><span style="color: #7f10d0; background-color: #ffffff;">(</span><span style="color: #8f0075;">double</span><span style="color: #006800; background-color: #ffffff;">(</span>i<span style="color: #006800; background-color: #ffffff;">)</span> <span style="color: #5317ac;">*</span> viewport_width <span style="color: #5317ac;">/</span> width<span style="color: #000000; background-color: #ffffff;">,</span>
            <span style="color: #8f0075;">double</span><span style="color: #006800; background-color: #ffffff;">(</span>j<span style="color: #006800; background-color: #ffffff;">)</span> <span style="color: #5317ac;">*</span> viewport_height <span style="color: #5317ac;">/</span> height<span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0.0</span><span style="color: #7f10d0; background-color: #ffffff;">)</span>
            <span style="color: #5317ac;">+</span> lower_left_corner <span style="color: #5317ac;">-</span> origin<span style="color: #904200; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>

          <span style="color: #505050;">// color pixel = ray_color(r);</span>

           <span style="color: #505050;">// double u = double(i) / (width-1); // fraction of width</span>
           <span style="color: #505050;">// double v = double(j) / (height-1); // fraction of height</span>
           <span style="color: #505050;">// // why write origin here? well its because the origin may not always be [0, 0, 0]</span>
           <span style="color: #505050;">// ray r(origin, lower_left_corner + u * horizontal + v * vertical - origin);</span>


           <span style="color: #005a5f;">color</span> <span style="color: #00538b;">pixel</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">ray_color</span><span style="color: #904200; background-color: #ffffff;">(</span>r<span style="color: #904200; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
           <span style="color: #0000c0;">write_color</span><span style="color: #904200; background-color: #ffffff;">(</span><span style="color: #005a5f;">std</span>::cout<span style="color: #000000; background-color: #ffffff;">,</span> pixel<span style="color: #904200; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
        <span style="color: #005f88; background-color: #ffffff;">}</span>
    <span style="color: #a8007f; background-color: #ffffff;">}</span>
<span style="color: #000000; background-color: #ffffff;">}</span>
</pre>
</div>

<p>
<b>Output</b>
</p>

<p>
The resultant image is a gradient from blue to white. Notice that not only is there a
vertical gradient, but also a horizontal one.
To explain this, we look at the <code>ray_color</code> function:
</p>
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #005a5f;">color</span> <span style="color: #721045;">ray_color</span><span style="color: #000000; background-color: #ffffff;">(</span><span style="color: #5317ac;">const</span> <span style="color: #005a5f;">ray</span><span style="color: #5317ac;">&amp;</span> <span style="color: #00538b;">r</span><span style="color: #000000; background-color: #ffffff;">)</span> <span style="color: #000000; background-color: #ffffff;">{</span>
    <span style="color: #005a5f;">vec3</span> <span style="color: #00538b;">unit_direction</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">unit_vector</span><span style="color: #a8007f; background-color: #ffffff;">(</span>r<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">direction</span><span style="color: #005f88; background-color: #ffffff;">()</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #505050;">// transformation to make to from 0 to 1</span>
    <span style="color: #005a5f;">auto</span> <span style="color: #00538b;">t</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">0.5</span> <span style="color: #5317ac;">*</span> <span style="color: #a8007f; background-color: #ffffff;">(</span>unit_direction<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">y</span><span style="color: #005f88; background-color: #ffffff;">()</span> <span style="color: #5317ac;">+</span> <span style="color: #0000c0;">1.0</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span> 
    <span style="color: #505050;">// the gradient color (blue-white) depends on where the</span>
    <span style="color: #505050;">// y-value sits.</span>
    <span style="color: #505050;">// higher y values -&gt; more blue</span>
    <span style="color: #5317ac;">return</span> t <span style="color: #5317ac;">*</span> <span style="color: #0000c0;">color</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">0.5</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0.7</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">1.0</span><span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #5317ac;">+</span> <span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">1</span> <span style="color: #5317ac;">-</span> t<span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #5317ac;">*</span> <span style="color: #0000c0;">color</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">1.0</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">1.0</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">1.0</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
<span style="color: #000000; background-color: #ffffff;">}</span>
</pre>
</div>
<p>
Unit vector makes the direction component of the ray unit length.
This means that when we take the y component of all of those rays,
the rays closer to the fringes when normalized dont extend as far
into the y direction (because of some of the length contributed to
the other components of the vector). We can also guarantee that no
y component of any normalised vector will be greater than \(\pm 1\).
We perform a transformation on the y scale to get a t that is \(0 \leq t \leq 1\).
When \(t = 1\), we get blue, and when \(t = 0\) we get white.
As a result the following is produced.
</p>


<div id="org7100882" class="figure">
<p><img src="./images/gradient-rt.png" alt="gradient-rt.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgbe4c3ea" class="outline-2">
<h2 id="orgbe4c3ea"><span class="section-number-2">4.</span> Adding a sphere to the scene</h2>
<div class="outline-text-2" id="text-4">
<p>
Time to add an object to the ray tracer!
</p>
</div>

<div id="outline-container-orgd137b50" class="outline-3">
<h3 id="orgd137b50"><span class="section-number-3">4.1.</span> Hit detection</h3>
<div class="outline-text-3" id="text-4-1">
<p>
Recall the equation for a sphere with center \((C_x, C_y, C_z)\):
\[ (x-C_x)^2 + (y-C_y)^2 + (z-C_z)^2 = r^2 \]
</p>

<p>
So to determine if a point \((a, b, c)\) is in a sphere, you would
check if
\[ (x-C_x)^2 + (y-C_y)^2 + (z-C_z)^2 < r^2 \]
</p>
</div>

<div id="outline-container-orgbf5716f" class="outline-4">
<h4 id="orgbf5716f"><span class="section-number-4">4.1.1.</span> Expressing as vectors</h4>
<div class="outline-text-4" id="text-4-1-1">
<p>
Now, \((x-C_x)^2 + (y-C_y)^2 + (z-C_z)^2\) is great and all but
we need it to be in the form of vectors for the <code>vec3</code> class.
Claim: \((\textbf{P - C})\cdot(\textbf{P - C}) = (x-C_x)^2 + (y-C_y)^2 + (z-C_z)^2\),
where \(P\) is a point \((x, y, z)\), and \(C = (C_x, C_y, C_z)\)
is the center of the sphere.
</p>

\begin{align*}
(\textbf{P - C})\cdot(\textbf{P - C}) &=
\left[ {\begin{array}{c}
  x-C_x \\
  y-C_y \\
  z-C_z \\
\end{array}}\right] \cdot
\left[ {\begin{array}{c}
  x-C_x \\
  y-C_y \\
  z-C_z \\
\end{array}}\right] &&\text{Recall the dot product: $a\cdot b = \sum_{i=1}^n a_ib_i$} \\\\
&= (x-C_x)(x-C_x) + (y-C_y)(y-C_y) + (z-C_z)(z-C_z) \\
&= (x-C_x)^2 + (y-C_y)^2 + (z-C_z)^2 \\
\end{align*}

<p>
Thus,
\[(\textbf{P-C})\cdot(\textbf{P-C}) = r^2 \]
</p>
</div>
</div>

<div id="outline-container-org340060b" class="outline-4">
<h4 id="org340060b"><span class="section-number-4">4.1.2.</span> Detecting if rays hit sphere</h4>
<div class="outline-text-4" id="text-4-1-2">
<p>
The above equation only answers whether a point \(\textbf{P}\)
is on the sphere. We want to know if a ray ever hits the
sphere. To do this, we substitute \(\textbf{P}\) for
\(\textbf{P}(t)=\textbf{A} + t\textbf{B}\), and find value
\(t\) such that this equation holds:
</p>
\begin{align*}
(\textbf{P}(t) - \textbf{C})\cdot(\textbf{P}(t) - \textbf{C}) &= r^2 \\
(\textbf{A}+t\textbf{b} - \textbf{C})\cdot
(\textbf{A}+t\textbf{b} - \textbf{C}) &= r^2 \\
(t\textbf{b} + (\textbf{A} - \textbf{C})) \cdot
(t\textbf{b} + (\textbf{A} - \textbf{C})) &= r^2 \\
t^2\textbf{b}*\textbf{b} + 2t\textbf{b}\cdot(\textbf{A-C}) +
(\textbf{A-C})\cdot(\textbf{A-C}) - r^2 &= 0 \\
\end{align*}

<p>
1 intersection means the ray touches the sphere once,
2 intersections means the ray passes through the sphere.
These intersections can be found in this quadratic equation,
but we are only concerned with whether the ray hits the sphere.
</p>

<p>
We have a handy quadratic equation to find roots:
\[x = \frac{-b \pm \sqrt{b^2 - 4ac}}{2a} \]
</p>

<p>
If \(b^2 - 4ac\) is negative, then there are no roots.
So, for the ray \(\textbf{P}(t) = \textbf{A} + t\textbf{b}\)
to not intersect the shape,
</p>
\begin{align*}
(2b\cdot(\textbf{A-C}))^2 - 4(\textbf{b} \cdot b)((\textbf{A-C})
    \cdot (\textbf{A-C}) - r^2) < 0 \\
\end{align*}
<p>
must hold true.
</p>
</div>
</div>

<div id="outline-container-orga8a021d" class="outline-4">
<h4 id="orga8a021d"><span class="section-number-4">4.1.3.</span> Example: Adding the shape to our gradient</h4>
<div class="outline-text-4" id="text-4-1-3">
<p>
We create a function called <code>hit_sphere</code> which given a sphere, returns whether
the ray hits the sphere.
For now, we color the rays that hit the sphere red in our final result.
</p>

<p>
<b>Source</b>
</p>
<div class="org-src-container">
<pre class="src src-C++" id="orge46fe22">  <span style="color: #a0132f;">#include</span> <span style="color: #2544bb;">"util/color.h"</span>
  <span style="color: #a0132f;">#include</span> <span style="color: #2544bb;">"util/ray.h"</span>
  <span style="color: #a0132f;">#include</span> <span style="color: #2544bb;">"util/vec3.h"</span>

  <span style="color: #a0132f;">#include</span> <span style="color: #2544bb;">&lt;iostream&gt;</span>

  <span style="color: #505050;">// check if the ray intersects the sphere</span>
  <span style="color: #8f0075;">bool</span> <span style="color: #721045;">hit_sphere</span><span style="color: #000000; background-color: #ffffff;">(</span><span style="color: #5317ac;">const</span> <span style="color: #005a5f;">point3</span><span style="color: #5317ac;">&amp;</span> <span style="color: #00538b;">center</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #8f0075;">double</span> <span style="color: #00538b;">radius</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #5317ac;">const</span> <span style="color: #005a5f;">ray</span><span style="color: #5317ac;">&amp;</span> <span style="color: #00538b;">ray</span><span style="color: #000000; background-color: #ffffff;">)</span> <span style="color: #000000; background-color: #ffffff;">{</span>
    <span style="color: #005a5f;">vec3</span> <span style="color: #00538b;">org_min_c</span> <span style="color: #5317ac;">=</span> ray<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">origin</span><span style="color: #a8007f; background-color: #ffffff;">()</span> <span style="color: #5317ac;">-</span> center<span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #8f0075;">double</span> <span style="color: #00538b;">a</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">dot</span><span style="color: #a8007f; background-color: #ffffff;">(</span>ray<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">direction</span><span style="color: #005f88; background-color: #ffffff;">()</span><span style="color: #000000; background-color: #ffffff;">,</span> ray<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">direction</span><span style="color: #005f88; background-color: #ffffff;">()</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #8f0075;">double</span> <span style="color: #00538b;">b</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">dot</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">2</span><span style="color: #5317ac;">*</span>ray<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">direction</span><span style="color: #005f88; background-color: #ffffff;">()</span><span style="color: #000000; background-color: #ffffff;">,</span> org_min_c<span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #8f0075;">double</span> <span style="color: #00538b;">c</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">dot</span><span style="color: #a8007f; background-color: #ffffff;">(</span>org_min_c<span style="color: #000000; background-color: #ffffff;">,</span> org_min_c<span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #5317ac;">-</span> radius<span style="color: #5317ac;">*</span>radius<span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #5317ac;">return</span> b<span style="color: #5317ac;">*</span>b <span style="color: #5317ac;">-</span> <span style="color: #0000c0;">4</span><span style="color: #5317ac;">*</span>a<span style="color: #5317ac;">*</span>c <span style="color: #5317ac;">&gt;=</span> <span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">;</span> <span style="color: #505050;">// i left it as geq 0 for now.</span>
  <span style="color: #000000; background-color: #ffffff;">}</span>

  <span style="color: #505050;">// this function returns a color for which ray its on.</span>
  <span style="color: #005a5f;">color</span> <span style="color: #721045;">ray_color</span><span style="color: #000000; background-color: #ffffff;">(</span><span style="color: #5317ac;">const</span> <span style="color: #005a5f;">ray</span><span style="color: #5317ac;">&amp;</span> <span style="color: #00538b;">r</span><span style="color: #000000; background-color: #ffffff;">)</span> <span style="color: #000000; background-color: #ffffff;">{</span>
    <span style="color: #5317ac;">if</span> <span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">hit_sphere</span><span style="color: #005f88; background-color: #ffffff;">(</span><span style="color: #0000c0;">point3</span><span style="color: #904200; background-color: #ffffff;">(</span><span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">,</span><span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">,</span><span style="color: #0000c0;">-1</span><span style="color: #904200; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0.5</span><span style="color: #000000; background-color: #ffffff;">,</span> r<span style="color: #005f88; background-color: #ffffff;">)</span><span style="color: #a8007f; background-color: #ffffff;">)</span>
      <span style="color: #5317ac;">return</span> <span style="color: #0000c0;">color</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">1</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span> <span style="color: #505050;">// if hit sphere, then color it red.</span>
    <span style="color: #005a5f;">vec3</span> <span style="color: #00538b;">unit_direction</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">unit_vector</span><span style="color: #a8007f; background-color: #ffffff;">(</span>r<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">direction</span><span style="color: #005f88; background-color: #ffffff;">()</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #505050;">// this is to try and put the pixel in the center y</span>
    <span style="color: #005a5f;">auto</span> <span style="color: #00538b;">t</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">0.5</span> <span style="color: #5317ac;">*</span> <span style="color: #a8007f; background-color: #ffffff;">(</span>unit_direction<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">y</span><span style="color: #005f88; background-color: #ffffff;">()</span> <span style="color: #5317ac;">+</span> <span style="color: #0000c0;">1.0</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span> 
    <span style="color: #505050;">// the gradient color (blue-white) depends on where the</span>
    <span style="color: #505050;">// y-value sits.</span>
    <span style="color: #505050;">// higher y values -&gt; more blue</span>
    <span style="color: #5317ac;">return</span> t <span style="color: #5317ac;">*</span> <span style="color: #0000c0;">color</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">0.5</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0.7</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">1.0</span><span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #5317ac;">+</span> <span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">1</span> <span style="color: #5317ac;">-</span> t<span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #5317ac;">*</span> <span style="color: #0000c0;">color</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">1.0</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">1.0</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">1.0</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #000000; background-color: #ffffff;">}</span>

  <span style="color: #8f0075;">int</span> <span style="color: #721045;">main</span><span style="color: #000000; background-color: #ffffff;">()</span> <span style="color: #000000; background-color: #ffffff;">{</span>

    <span style="color: #505050;">// image</span>
    <span style="color: #8f0075;">double</span> <span style="color: #00538b;">aspect</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">16.0</span> <span style="color: #5317ac;">/</span> <span style="color: #0000c0;">9.0</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #8f0075;">int</span> <span style="color: #00538b;">height</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">200</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #8f0075;">int</span> <span style="color: #00538b;">width</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">static_cast</span><span style="color: #a8007f;">&lt;</span><span style="color: #8f0075;">int</span><span style="color: #a8007f;">&gt;</span><span style="color: #a8007f; background-color: #ffffff;">(</span>height <span style="color: #5317ac;">*</span> aspect<span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>

    <span style="color: #505050;">// camera setup</span>

    <span style="color: #8f0075;">double</span> <span style="color: #00538b;">viewport_height</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">2.0</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #8f0075;">double</span> <span style="color: #00538b;">viewport_width</span> <span style="color: #5317ac;">=</span> viewport_height <span style="color: #5317ac;">*</span> aspect<span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #8f0075;">double</span> <span style="color: #00538b;">focal_length</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">1.0</span><span style="color: #000000; background-color: #ffffff;">;</span>

    <span style="color: #005a5f;">point3</span> <span style="color: #00538b;">origin</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">0.0</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0.0</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0.0</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #005a5f;">vec3</span> <span style="color: #00538b;">horizontal</span><span style="color: #a8007f; background-color: #ffffff;">(</span>viewport_width<span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0.0</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0.0</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #005a5f;">vec3</span> <span style="color: #00538b;">vertical</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">0.0</span><span style="color: #000000; background-color: #ffffff;">,</span> viewport_height<span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0.0</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #005a5f;">vec3</span> <span style="color: #00538b;">lower_left_corner</span> <span style="color: #5317ac;">=</span> origin <span style="color: #5317ac;">-</span> horizontal <span style="color: #5317ac;">/</span> <span style="color: #0000c0;">2</span> <span style="color: #5317ac;">-</span>
       vertical <span style="color: #5317ac;">/</span> <span style="color: #0000c0;">2</span> <span style="color: #5317ac;">-</span> <span style="color: #0000c0;">vec3</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">0.0</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0.0</span><span style="color: #000000; background-color: #ffffff;">,</span> focal_length<span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>

    <span style="color: #505050;">// Render</span>
    <span style="color: #005a5f;">std</span>::cout <span style="color: #5317ac;">&lt;&lt;</span> <span style="color: #2544bb;">"P3\n"</span> <span style="color: #5317ac;">&lt;&lt;</span> width <span style="color: #5317ac;">&lt;&lt;</span> <span style="color: #2544bb;">" "</span> <span style="color: #5317ac;">&lt;&lt;</span> height
              <span style="color: #5317ac;">&lt;&lt;</span> <span style="color: #2544bb;">"\n255"</span>  <span style="color: #5317ac;">&lt;&lt;</span> <span style="color: #005a5f;">std</span>::endl<span style="color: #000000; background-color: #ffffff;">;</span>

    <span style="color: #505050;">// loop</span>
    <span style="color: #5317ac;">for</span> <span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #8f0075;">int</span> <span style="color: #00538b;">j</span> <span style="color: #5317ac;">=</span> height<span style="color: #5317ac;">-</span><span style="color: #0000c0;">1</span><span style="color: #000000; background-color: #ffffff;">;</span> j <span style="color: #5317ac;">&gt;=</span> <span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">;</span> <span style="color: #5317ac;">--</span><span style="color: #00538b;">j</span><span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #a8007f; background-color: #ffffff;">{</span> <span style="color: #505050;">// explanation: scans pixels L-&gt;R U-&gt;D</span>
      <span style="color: #5317ac;">for</span> <span style="color: #005f88; background-color: #ffffff;">(</span><span style="color: #8f0075;">int</span> <span style="color: #00538b;">i</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">;</span> i <span style="color: #5317ac;">&lt;</span> width<span style="color: #000000; background-color: #ffffff;">;</span> <span style="color: #5317ac;">++</span><span style="color: #00538b;">i</span><span style="color: #005f88; background-color: #ffffff;">)</span> <span style="color: #005f88; background-color: #ffffff;">{</span> <span style="color: #505050;">// i thus needs to be in the inner loop</span>

          <span style="color: #005a5f;">ray</span> <span style="color: #00538b;">r</span><span style="color: #904200; background-color: #ffffff;">(</span>origin<span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">vec3</span><span style="color: #7f10d0; background-color: #ffffff;">(</span><span style="color: #8f0075;">double</span><span style="color: #006800; background-color: #ffffff;">(</span>i<span style="color: #006800; background-color: #ffffff;">)</span> <span style="color: #5317ac;">*</span> viewport_width <span style="color: #5317ac;">/</span> width<span style="color: #000000; background-color: #ffffff;">,</span>
            <span style="color: #8f0075;">double</span><span style="color: #006800; background-color: #ffffff;">(</span>j<span style="color: #006800; background-color: #ffffff;">)</span> <span style="color: #5317ac;">*</span> viewport_height <span style="color: #5317ac;">/</span> height<span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0.0</span><span style="color: #7f10d0; background-color: #ffffff;">)</span>
            <span style="color: #5317ac;">+</span> lower_left_corner <span style="color: #5317ac;">-</span> origin<span style="color: #904200; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>

           <span style="color: #005a5f;">color</span> <span style="color: #00538b;">pixel</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">ray_color</span><span style="color: #904200; background-color: #ffffff;">(</span>r<span style="color: #904200; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
           <span style="color: #0000c0;">write_color</span><span style="color: #904200; background-color: #ffffff;">(</span><span style="color: #005a5f;">std</span>::cout<span style="color: #000000; background-color: #ffffff;">,</span> pixel<span style="color: #904200; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
        <span style="color: #005f88; background-color: #ffffff;">}</span>
    <span style="color: #a8007f; background-color: #ffffff;">}</span>
<span style="color: #000000; background-color: #ffffff;">}</span>
</pre>
</div>

<p>
<b>Output:</b>
</p>

<div id="orgae74585" class="figure">
<p><img src="./images/red-circle.png" alt="red-circle.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org18fdaac" class="outline-3">
<h3 id="org18fdaac"><span class="section-number-3">4.2.</span> Surface Normals</h3>
<div class="outline-text-3" id="text-4-2">
<p>
A surface normal is the vector that is perpendicular to the surface of the point
of intersection.
For a point \(\textbf{P}\) on the sphere with center \(\textbf{C}\),
the normal vector would be \(\textbf{P} - \textbf{C}\).
Convince yourself that this is true.
We also normalize this vector so that each component is between -1 and 1.
</p>
</div>

<div id="outline-container-orgf076868" class="outline-4">
<h4 id="orgf076868"><span class="section-number-4">4.2.1.</span> Example: Visualizing The Normal</h4>
<div class="outline-text-4" id="text-4-2-1">
<p>
For now, we use a color map to visualize the normal. Since each vector is normalized,
each component is between -1 and 1, which we can map to an interval from
0 to 1. Then, we map \(x \mapsto r\), \(y \mapsto g\), and \(z \mapsto b\).
</p>

<p>
Let us visualize this:
<b>Source</b>
</p>
<div class="org-src-container">
<pre class="src src-C++" id="org7403111">  <span style="color: #a0132f;">#include</span> <span style="color: #2544bb;">"util/color.h"</span>
  <span style="color: #a0132f;">#include</span> <span style="color: #2544bb;">"util/ray.h"</span>
  <span style="color: #a0132f;">#include</span> <span style="color: #2544bb;">"util/vec3.h"</span>

  <span style="color: #a0132f;">#include</span> <span style="color: #2544bb;">&lt;iostream&gt;</span>

  <span style="color: #505050;">// check if the ray intersects the sphere, if so, return the t value of the ray</span>
  <span style="color: #505050;">// that touches the sphere.</span>
  <span style="color: #8f0075;">double</span> <span style="color: #721045;">hit_sphere</span><span style="color: #000000; background-color: #ffffff;">(</span><span style="color: #5317ac;">const</span> <span style="color: #005a5f;">point3</span><span style="color: #5317ac;">&amp;</span> <span style="color: #00538b;">center</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #8f0075;">double</span> <span style="color: #00538b;">radius</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #5317ac;">const</span> <span style="color: #005a5f;">ray</span><span style="color: #5317ac;">&amp;</span> <span style="color: #00538b;">ray</span><span style="color: #000000; background-color: #ffffff;">)</span> <span style="color: #000000; background-color: #ffffff;">{</span>
    <span style="color: #005a5f;">vec3</span> <span style="color: #00538b;">org_min_c</span> <span style="color: #5317ac;">=</span> ray<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">origin</span><span style="color: #a8007f; background-color: #ffffff;">()</span> <span style="color: #5317ac;">-</span> center<span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #8f0075;">double</span> <span style="color: #00538b;">a</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">dot</span><span style="color: #a8007f; background-color: #ffffff;">(</span>ray<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">direction</span><span style="color: #005f88; background-color: #ffffff;">()</span><span style="color: #000000; background-color: #ffffff;">,</span> ray<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">direction</span><span style="color: #005f88; background-color: #ffffff;">()</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #8f0075;">double</span> <span style="color: #00538b;">b</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">dot</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">2</span><span style="color: #5317ac;">*</span>ray<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">direction</span><span style="color: #005f88; background-color: #ffffff;">()</span><span style="color: #000000; background-color: #ffffff;">,</span> org_min_c<span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #8f0075;">double</span> <span style="color: #00538b;">c</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">dot</span><span style="color: #a8007f; background-color: #ffffff;">(</span>org_min_c<span style="color: #000000; background-color: #ffffff;">,</span> org_min_c<span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #5317ac;">-</span> radius<span style="color: #5317ac;">*</span>radius<span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #8f0075;">double</span> <span style="color: #00538b;">discriminant</span> <span style="color: #5317ac;">=</span> b<span style="color: #5317ac;">*</span>b <span style="color: #5317ac;">-</span> <span style="color: #0000c0;">4</span><span style="color: #5317ac;">*</span>a<span style="color: #5317ac;">*</span>c<span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #5317ac;">if</span> <span style="color: #a8007f; background-color: #ffffff;">(</span>discriminant <span style="color: #5317ac;">&lt;</span> <span style="color: #0000c0;">0</span><span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #a8007f; background-color: #ffffff;">{</span>
       <span style="color: #505050;">// why return -1? When is it -1?</span>
       <span style="color: #505050;">// means the object is behind the ray...</span>
       <span style="color: #5317ac;">return</span> <span style="color: #0000c0;">-1.0</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #a8007f; background-color: #ffffff;">}</span> <span style="color: #5317ac;">else</span> <span style="color: #a8007f; background-color: #ffffff;">{</span>
       <span style="color: #5317ac;">return</span> <span style="color: #005f88; background-color: #ffffff;">(</span><span style="color: #5317ac;">-</span>b <span style="color: #5317ac;">-</span> <span style="color: #0000c0;">sqrt</span><span style="color: #904200; background-color: #ffffff;">(</span>discriminant<span style="color: #904200; background-color: #ffffff;">)</span><span style="color: #005f88; background-color: #ffffff;">)</span> <span style="color: #5317ac;">/</span> <span style="color: #005f88; background-color: #ffffff;">(</span><span style="color: #0000c0;">2.0</span> <span style="color: #5317ac;">*</span> a<span style="color: #005f88; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #a8007f; background-color: #ffffff;">}</span>
  <span style="color: #000000; background-color: #ffffff;">}</span>

  <span style="color: #505050;">// this function returns a color for which ray its on.</span>
  <span style="color: #005a5f;">color</span> <span style="color: #721045;">ray_color</span><span style="color: #000000; background-color: #ffffff;">(</span><span style="color: #5317ac;">const</span> <span style="color: #005a5f;">ray</span><span style="color: #5317ac;">&amp;</span> <span style="color: #00538b;">r</span><span style="color: #000000; background-color: #ffffff;">)</span> <span style="color: #000000; background-color: #ffffff;">{</span>
    <span style="color: #005a5f;">point3</span> <span style="color: #00538b;">sphere_center</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">,</span><span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">,</span><span style="color: #0000c0;">-1</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #8f0075;">double</span> <span style="color: #00538b;">t</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">hit_sphere</span><span style="color: #a8007f; background-color: #ffffff;">(</span>sphere_center<span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0.5</span><span style="color: #000000; background-color: #ffffff;">,</span> r<span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #5317ac;">if</span> <span style="color: #a8007f; background-color: #ffffff;">(</span>t <span style="color: #5317ac;">&gt;</span> <span style="color: #0000c0;">0.0</span><span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #a8007f; background-color: #ffffff;">{</span>
       <span style="color: #505050;">// calculate the norm (P - C)</span>
       <span style="color: #005a5f;">vec3</span> <span style="color: #00538b;">norm</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">unit_vector</span><span style="color: #005f88; background-color: #ffffff;">(</span>r<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">origin</span><span style="color: #904200; background-color: #ffffff;">()</span> <span style="color: #5317ac;">+</span> t <span style="color: #5317ac;">*</span> r<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">direction</span><span style="color: #904200; background-color: #ffffff;">()</span> <span style="color: #5317ac;">-</span> sphere_center<span style="color: #005f88; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
       <span style="color: #5317ac;">return</span> <span style="color: #0000c0;">0.5</span> <span style="color: #5317ac;">*</span> <span style="color: #005f88; background-color: #ffffff;">(</span>norm <span style="color: #5317ac;">+</span> <span style="color: #0000c0;">vec3</span><span style="color: #904200; background-color: #ffffff;">(</span><span style="color: #0000c0;">1</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">1</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">1</span><span style="color: #904200; background-color: #ffffff;">)</span><span style="color: #005f88; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span> 
    <span style="color: #a8007f; background-color: #ffffff;">}</span>
    <span style="color: #005a5f;">vec3</span> <span style="color: #00538b;">unit_direction</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">unit_vector</span><span style="color: #a8007f; background-color: #ffffff;">(</span>r<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">direction</span><span style="color: #005f88; background-color: #ffffff;">()</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #505050;">// this is to try and put the pixel in the center y</span>
    <span style="color: #00538b;">t</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">0.5</span> <span style="color: #5317ac;">*</span> <span style="color: #a8007f; background-color: #ffffff;">(</span>unit_direction<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">y</span><span style="color: #005f88; background-color: #ffffff;">()</span> <span style="color: #5317ac;">+</span> <span style="color: #0000c0;">1.0</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span> 
    <span style="color: #505050;">// the gradient color (blue-white) depends on where the</span>
    <span style="color: #505050;">// y-value sits.</span>
    <span style="color: #505050;">// higher y values -&gt; more blue</span>
    <span style="color: #5317ac;">return</span> t <span style="color: #5317ac;">*</span> <span style="color: #0000c0;">color</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">0.5</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0.7</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">1.0</span><span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #5317ac;">+</span> <span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">1</span> <span style="color: #5317ac;">-</span> t<span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #5317ac;">*</span> <span style="color: #0000c0;">color</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">1.0</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">1.0</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">1.0</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #000000; background-color: #ffffff;">}</span>

  <span style="color: #8f0075;">int</span> <span style="color: #721045;">main</span><span style="color: #000000; background-color: #ffffff;">()</span> <span style="color: #000000; background-color: #ffffff;">{</span>
    <span style="color: #505050;">// image</span>
    <span style="color: #8f0075;">double</span> <span style="color: #00538b;">aspect</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">16.0</span> <span style="color: #5317ac;">/</span> <span style="color: #0000c0;">9.0</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #8f0075;">int</span> <span style="color: #00538b;">height</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">200</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #8f0075;">int</span> <span style="color: #00538b;">width</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">static_cast</span><span style="color: #a8007f;">&lt;</span><span style="color: #8f0075;">int</span><span style="color: #a8007f;">&gt;</span><span style="color: #a8007f; background-color: #ffffff;">(</span>height <span style="color: #5317ac;">*</span> aspect<span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>

    <span style="color: #505050;">// camera setup</span>
    <span style="color: #8f0075;">double</span> <span style="color: #00538b;">viewport_height</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">2.0</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #8f0075;">double</span> <span style="color: #00538b;">viewport_width</span> <span style="color: #5317ac;">=</span> viewport_height <span style="color: #5317ac;">*</span> aspect<span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #8f0075;">double</span> <span style="color: #00538b;">focal_length</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">1.0</span><span style="color: #000000; background-color: #ffffff;">;</span>

    <span style="color: #005a5f;">point3</span> <span style="color: #00538b;">origin</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">0.0</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0.0</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0.0</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #005a5f;">vec3</span> <span style="color: #00538b;">horizontal</span><span style="color: #a8007f; background-color: #ffffff;">(</span>viewport_width<span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0.0</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0.0</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #005a5f;">vec3</span> <span style="color: #00538b;">vertical</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">0.0</span><span style="color: #000000; background-color: #ffffff;">,</span> viewport_height<span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0.0</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #005a5f;">vec3</span> <span style="color: #00538b;">lower_left_corner</span> <span style="color: #5317ac;">=</span> origin <span style="color: #5317ac;">-</span> horizontal <span style="color: #5317ac;">/</span> <span style="color: #0000c0;">2</span> <span style="color: #5317ac;">-</span>
       vertical <span style="color: #5317ac;">/</span> <span style="color: #0000c0;">2</span> <span style="color: #5317ac;">-</span> <span style="color: #0000c0;">vec3</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">0.0</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0.0</span><span style="color: #000000; background-color: #ffffff;">,</span> focal_length<span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>

    <span style="color: #505050;">// Render</span>
    <span style="color: #005a5f;">std</span>::cout <span style="color: #5317ac;">&lt;&lt;</span> <span style="color: #2544bb;">"P3\n"</span> <span style="color: #5317ac;">&lt;&lt;</span> width <span style="color: #5317ac;">&lt;&lt;</span> <span style="color: #2544bb;">" "</span> <span style="color: #5317ac;">&lt;&lt;</span> height
              <span style="color: #5317ac;">&lt;&lt;</span> <span style="color: #2544bb;">"\n255"</span>  <span style="color: #5317ac;">&lt;&lt;</span> <span style="color: #005a5f;">std</span>::endl<span style="color: #000000; background-color: #ffffff;">;</span>

    <span style="color: #505050;">// loop</span>
    <span style="color: #5317ac;">for</span> <span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #8f0075;">int</span> <span style="color: #00538b;">j</span> <span style="color: #5317ac;">=</span> height<span style="color: #5317ac;">-</span><span style="color: #0000c0;">1</span><span style="color: #000000; background-color: #ffffff;">;</span> j <span style="color: #5317ac;">&gt;=</span> <span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">;</span> <span style="color: #5317ac;">--</span><span style="color: #00538b;">j</span><span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #a8007f; background-color: #ffffff;">{</span> <span style="color: #505050;">// explanation: scans pixels L-&gt;R U-&gt;D</span>
      <span style="color: #5317ac;">for</span> <span style="color: #005f88; background-color: #ffffff;">(</span><span style="color: #8f0075;">int</span> <span style="color: #00538b;">i</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">;</span> i <span style="color: #5317ac;">&lt;</span> width<span style="color: #000000; background-color: #ffffff;">;</span> <span style="color: #5317ac;">++</span><span style="color: #00538b;">i</span><span style="color: #005f88; background-color: #ffffff;">)</span> <span style="color: #005f88; background-color: #ffffff;">{</span> <span style="color: #505050;">// i thus needs to be in the inner loop</span>
          <span style="color: #005a5f;">ray</span> <span style="color: #00538b;">r</span><span style="color: #904200; background-color: #ffffff;">(</span>origin<span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">vec3</span><span style="color: #7f10d0; background-color: #ffffff;">(</span><span style="color: #8f0075;">double</span><span style="color: #006800; background-color: #ffffff;">(</span>i<span style="color: #006800; background-color: #ffffff;">)</span> <span style="color: #5317ac;">*</span> viewport_width <span style="color: #5317ac;">/</span> width<span style="color: #000000; background-color: #ffffff;">,</span>
            <span style="color: #8f0075;">double</span><span style="color: #006800; background-color: #ffffff;">(</span>j<span style="color: #006800; background-color: #ffffff;">)</span> <span style="color: #5317ac;">*</span> viewport_height <span style="color: #5317ac;">/</span> height<span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0.0</span><span style="color: #7f10d0; background-color: #ffffff;">)</span>
            <span style="color: #5317ac;">+</span> lower_left_corner <span style="color: #5317ac;">-</span> origin<span style="color: #904200; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
           <span style="color: #005a5f;">color</span> <span style="color: #00538b;">pixel</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">ray_color</span><span style="color: #904200; background-color: #ffffff;">(</span>r<span style="color: #904200; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
           <span style="color: #0000c0;">write_color</span><span style="color: #904200; background-color: #ffffff;">(</span><span style="color: #005a5f;">std</span>::cout<span style="color: #000000; background-color: #ffffff;">,</span> pixel<span style="color: #904200; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
        <span style="color: #005f88; background-color: #ffffff;">}</span>
    <span style="color: #a8007f; background-color: #ffffff;">}</span>
<span style="color: #000000; background-color: #ffffff;">}</span>
</pre>
</div>

<p>
<b>Output:</b>
</p>

<div id="orge1c7f87" class="figure">
<p><img src="./images/color-map-sphere.png" alt="color-map-sphere.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org02d685a" class="outline-3">
<h3 id="org02d685a"><span class="section-number-3">4.3.</span> Simplifying the intersection code.</h3>
<div class="outline-text-3" id="text-4-3">
<p>
There is an extra 2 in the front of b in our equation. Suppose we then used
\(b = 2h\) in our quadratic equation:
</p>
\begin{align*}
 \frac{-b \pm \sqrt{b^2 - 4ac}}{2a} \\
= \frac{-(2h) \pm \sqrt{(2h)^2 - 4ac}}{2a} \\
= \frac{-2h \pm \sqrt{4h^2 - 4ac}}{2a} \\
= \frac{-2h \pm 2\sqrt{h^2 - ac}}{2a} \\
= \frac{-h \pm \sqrt{h^2 - ac}}{a} \\
\end{align*}
<p>
Now we use these changes in our code:
</p>
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #505050;">// check if the ray intersects the sphere, if so, return the t value of the ray</span>
<span style="color: #505050;">// that touches the sphere.</span>
<span style="color: #8f0075;">double</span> <span style="color: #721045;">hit_sphere</span><span style="color: #000000; background-color: #ffffff;">(</span><span style="color: #5317ac;">const</span> <span style="color: #005a5f;">point3</span><span style="color: #5317ac;">&amp;</span> <span style="color: #00538b;">center</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #8f0075;">double</span> <span style="color: #00538b;">radius</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #5317ac;">const</span> <span style="color: #005a5f;">ray</span><span style="color: #5317ac;">&amp;</span> <span style="color: #00538b;">ray</span><span style="color: #000000; background-color: #ffffff;">)</span> <span style="color: #000000; background-color: #ffffff;">{</span>
  <span style="color: #005a5f;">vec3</span> <span style="color: #00538b;">org_min_c</span> <span style="color: #5317ac;">=</span> ray<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">origin</span><span style="color: #a8007f; background-color: #ffffff;">()</span> <span style="color: #5317ac;">-</span> center<span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #8f0075;">double</span> <span style="color: #00538b;">a</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">dot</span><span style="color: #a8007f; background-color: #ffffff;">(</span>ray<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">direction</span><span style="color: #005f88; background-color: #ffffff;">()</span><span style="color: #000000; background-color: #ffffff;">,</span> ray<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">direction</span><span style="color: #005f88; background-color: #ffffff;">()</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #8f0075;">double</span> <span style="color: #00538b;">h_b</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">dot</span><span style="color: #a8007f; background-color: #ffffff;">(</span>ray<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">direction</span><span style="color: #005f88; background-color: #ffffff;">()</span><span style="color: #000000; background-color: #ffffff;">,</span> org_min_c<span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #8f0075;">double</span> <span style="color: #00538b;">c</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">dot</span><span style="color: #a8007f; background-color: #ffffff;">(</span>org_min_c<span style="color: #000000; background-color: #ffffff;">,</span> org_min_c<span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #5317ac;">-</span> radius<span style="color: #5317ac;">*</span>radius<span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #8f0075;">double</span> <span style="color: #00538b;">discriminant</span> <span style="color: #5317ac;">=</span> h_b<span style="color: #5317ac;">*</span>h_b <span style="color: #5317ac;">-</span> a<span style="color: #5317ac;">*</span>c<span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #5317ac;">if</span> <span style="color: #a8007f; background-color: #ffffff;">(</span>discriminant <span style="color: #5317ac;">&lt;</span> <span style="color: #0000c0;">0</span><span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #a8007f; background-color: #ffffff;">{</span>
     <span style="color: #505050;">// why return -1? When is it -1?</span>
     <span style="color: #505050;">// means the object is behind the ray...</span>
     <span style="color: #5317ac;">return</span> <span style="color: #0000c0;">-1.0</span><span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #a8007f; background-color: #ffffff;">}</span> <span style="color: #5317ac;">else</span> <span style="color: #a8007f; background-color: #ffffff;">{</span>
     <span style="color: #5317ac;">return</span> <span style="color: #005f88; background-color: #ffffff;">(</span><span style="color: #5317ac;">-</span>h_b <span style="color: #5317ac;">-</span> <span style="color: #0000c0;">sqrt</span><span style="color: #904200; background-color: #ffffff;">(</span>discriminant<span style="color: #904200; background-color: #ffffff;">)</span><span style="color: #005f88; background-color: #ffffff;">)</span> <span style="color: #5317ac;">/</span> a<span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #a8007f; background-color: #ffffff;">}</span>
<span style="color: #000000; background-color: #ffffff;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd5374e9" class="outline-3">
<h3 id="orgd5374e9"><span class="section-number-3">4.4.</span> Abstraction to hittable objects</h3>
<div class="outline-text-3" id="text-4-4">
<p>
So what about several spheres? Or shapes? Let's generalize this problem
into an abstract class.
This generalized "surface" is anything that can be hit by rays.
</p>

<div class="org-src-container">
<pre class="src src-C++">
<span style="color: #5317ac;">struct</span> <span style="color: #005a5f;">hit_record</span> <span style="color: #000000; background-color: #ffffff;">{</span>
  <span style="color: #005a5f;">point3</span> <span style="color: #00538b; font-style: italic;">point</span><span style="color: #000000; background-color: #ffffff;">;</span> <span style="color: #505050;">// point of intersection</span>
  <span style="color: #005a5f;">vec3</span> <span style="color: #00538b; font-style: italic;">norm</span><span style="color: #000000; background-color: #ffffff;">;</span>    <span style="color: #505050;">// resultant norm of the intersection</span>
  <span style="color: #8f0075;">double</span> <span style="color: #00538b; font-style: italic;">t</span><span style="color: #000000; background-color: #ffffff;">;</span>     <span style="color: #505050;">// t-value of ray to get to point.</span>
<span style="color: #000000; background-color: #ffffff;">}</span>

class hittable <span style="color: #000000; background-color: #ffffff;">{</span>
  <span style="color: #a0132f;">public</span>:
    virtual <span style="color: #8f0075;">bool</span> <span style="color: #0000c0;">hit</span><span style="color: #a8007f; background-color: #ffffff;">(</span>const ray<span style="color: #5317ac;">&amp;</span> r<span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #8f0075;">double</span> t_min<span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #8f0075;">double</span> t_max<span style="color: #000000; background-color: #ffffff;">,</span> hit_record<span style="color: #5317ac;">&amp;</span> rec<span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #5317ac;">const</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">;</span>
<span style="color: #000000; background-color: #ffffff;">}</span>

</pre>
</div>

<p>
So we use this general class to implmement a sphere.
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #5317ac;">class</span> <span style="color: #005a5f;">sphere</span> : <span style="color: #5317ac;">public</span> <span style="color: #005a5f;">hittable</span> <span style="color: #000000; background-color: #ffffff;">{</span>
  <span style="color: #5317ac;">public</span>:
  <span style="color: #721045;">sphere</span><span style="color: #a8007f; background-color: #ffffff;">()</span> <span style="color: #a8007f; background-color: #ffffff;">{}</span>
  <span style="color: #721045;">sphere</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #005a5f;">point3</span> <span style="color: #00538b;">center</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #8f0075;">double</span> <span style="color: #00538b;">r</span><span style="color: #a8007f; background-color: #ffffff;">)</span> : <span style="color: #0000c0; font-style: italic;">center</span><span style="color: #a8007f; background-color: #ffffff;">(</span>center<span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0; font-style: italic;">radius</span><span style="color: #a8007f; background-color: #ffffff;">(</span>r<span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #a8007f; background-color: #ffffff;">{}</span><span style="color: #000000; background-color: #ffffff;">;</span>

  <span style="color: #5317ac;">virtual</span> <span style="color: #8f0075;">bool</span> <span style="color: #721045; font-style: italic;">hit</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #5317ac;">const</span> <span style="color: #005a5f;">ray</span><span style="color: #5317ac;">&amp;</span> <span style="color: #00538b;">r</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #8f0075;">double</span> <span style="color: #00538b;">t_min</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #8f0075;">double</span> <span style="color: #00538b;">t_max</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #005a5f;">hit_record</span><span style="color: #5317ac;">&amp;</span> <span style="color: #00538b;">rec</span><span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #5317ac;">const</span> <span style="color: #5317ac;">override</span><span style="color: #000000; background-color: #ffffff;">;</span>

  <span style="color: #5317ac;">public</span>:
    <span style="color: #005a5f;">point3</span> <span style="color: #00538b; font-style: italic;">center</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #8f0075;">double</span> <span style="color: #00538b; font-style: italic;">radius</span><span style="color: #000000; background-color: #ffffff;">;</span>
<span style="color: #000000; background-color: #ffffff;">}</span>

bool <span style="color: #005a5f;">sphere</span>::<span style="color: #721045;">hit</span><span style="color: #000000; background-color: #ffffff;">(</span><span style="color: #5317ac;">const</span> <span style="color: #005a5f;">ray</span><span style="color: #5317ac;">&amp;</span><span style="color: #00538b;">r</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #8f0075;">double</span> <span style="color: #00538b;">t_min</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #8f0075;">double</span> <span style="color: #00538b;">t_max</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #005a5f;">hit_record</span><span style="color: #5317ac;">&amp;</span> <span style="color: #00538b;">rec</span><span style="color: #000000; background-color: #ffffff;">)</span> <span style="color: #5317ac;">const</span> <span style="color: #000000; background-color: #ffffff;">{</span>
  <span style="color: #005a5f;">vec3</span> <span style="color: #00538b;">org_min_c</span> <span style="color: #5317ac;">=</span> r<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">origin</span><span style="color: #a8007f; background-color: #ffffff;">()</span> <span style="color: #5317ac;">-</span> center<span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #8f0075;">double</span> <span style="color: #00538b;">a</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">dot</span><span style="color: #a8007f; background-color: #ffffff;">(</span>r<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">direction</span><span style="color: #005f88; background-color: #ffffff;">()</span><span style="color: #000000; background-color: #ffffff;">,</span> r<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">direction</span><span style="color: #005f88; background-color: #ffffff;">()</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #8f0075;">double</span> <span style="color: #00538b;">h_b</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">dot</span><span style="color: #a8007f; background-color: #ffffff;">(</span>ray<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">direction</span><span style="color: #005f88; background-color: #ffffff;">()</span><span style="color: #000000; background-color: #ffffff;">,</span> org_min_c<span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #8f0075;">double</span> <span style="color: #00538b;">c</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">dot</span><span style="color: #a8007f; background-color: #ffffff;">(</span>org_min_c<span style="color: #000000; background-color: #ffffff;">,</span> org_min_c<span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #5317ac;">-</span> radius<span style="color: #5317ac;">*</span>radius<span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #8f0075;">double</span> <span style="color: #00538b;">discriminant</span> <span style="color: #5317ac;">=</span> h_b<span style="color: #5317ac;">*</span>h_b <span style="color: #5317ac;">-</span> a<span style="color: #5317ac;">*</span>c<span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #5317ac;">if</span> <span style="color: #a8007f; background-color: #ffffff;">(</span>discriminant <span style="color: #5317ac;">&lt;</span> <span style="color: #0000c0;">0</span><span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #a8007f; background-color: #ffffff;">{</span>
    <span style="color: #5317ac;">return</span> <span style="color: #8f0075;">false</span><span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #a8007f; background-color: #ffffff;">}</span> <span style="color: #5317ac;">else</span> <span style="color: #a8007f; background-color: #ffffff;">{</span>
    <span style="color: #8f0075;">double</span> <span style="color: #00538b;">sqrtd</span> <span style="color: #5317ac;">=</span> <span style="color: #005a5f;">std</span>::<span style="color: #0000c0;">sqrt</span><span style="color: #005f88; background-color: #ffffff;">(</span>discriminant<span style="color: #005f88; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #8f0075;">double</span> <span style="color: #00538b;">root</span> <span style="color: #5317ac;">=</span> <span style="color: #005f88; background-color: #ffffff;">(</span><span style="color: #5317ac;">-</span>h <span style="color: #5317ac;">-</span> sqrtd<span style="color: #005f88; background-color: #ffffff;">)</span> <span style="color: #5317ac;">/</span> a<span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #5317ac;">if</span> <span style="color: #005f88; background-color: #ffffff;">(</span>t_min <span style="color: #5317ac;">&gt;</span> root <span style="color: #5317ac;">||</span> t_max <span style="color: #5317ac;">&lt;</span> root<span style="color: #005f88; background-color: #ffffff;">)</span> <span style="color: #005f88; background-color: #ffffff;">{</span>
      <span style="color: #00538b;">root</span> <span style="color: #5317ac;">=</span> <span style="color: #904200; background-color: #ffffff;">(</span><span style="color: #5317ac;">-</span>h <span style="color: #5317ac;">+</span> sqrtd<span style="color: #904200; background-color: #ffffff;">)</span> <span style="color: #5317ac;">/</span> a<span style="color: #000000; background-color: #ffffff;">;</span>
      <span style="color: #5317ac;">if</span> <span style="color: #904200; background-color: #ffffff;">(</span>t_min <span style="color: #5317ac;">&gt;</span> root <span style="color: #5317ac;">||</span> t_max <span style="color: #5317ac;">&lt;</span> root<span style="color: #904200; background-color: #ffffff;">)</span> <span style="color: #904200; background-color: #ffffff;">{</span>
        <span style="color: #5317ac;">return</span> <span style="color: #8f0075;">false</span><span style="color: #000000; background-color: #ffffff;">;</span>
      <span style="color: #904200; background-color: #ffffff;">}</span>
    <span style="color: #005f88; background-color: #ffffff;">}</span>
    rec<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #00538b; font-style: italic;">t</span> <span style="color: #5317ac;">=</span> root<span style="color: #000000; background-color: #ffffff;">;</span>
    rec<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #00538b; font-style: italic;">point</span> <span style="color: #5317ac;">=</span> r<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">at</span><span style="color: #005f88; background-color: #ffffff;">(</span>rec<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">t</span><span style="color: #005f88; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
    rec<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #00538b; font-style: italic;">norm</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">unit_vector</span><span style="color: #005f88; background-color: #ffffff;">(</span>rec<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">point</span> <span style="color: #5317ac;">-</span> center<span style="color: #005f88; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span> <span style="color: #505050;">// this will always be radius</span>

    <span style="color: #5317ac;">return</span> <span style="color: #8f0075;">true</span><span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #a8007f; background-color: #ffffff;">}</span>
<span style="color: #000000; background-color: #ffffff;">}</span>
</pre>
</div>
</div>

<div id="outline-container-org3f22384" class="outline-4">
<h4 id="org3f22384"><span class="section-number-4">4.4.1.</span> Front Faces vs Back Faces</h4>
<div class="outline-text-4" id="text-4-4-1">
<p>
In the code above, the normal always points outwards from the center of the sphere, even
if the ray intersects the sphere from the inside.
</p>

<p>
From the book, it says that we need to know which side the ray is on
when we color the sphere. If we choose to always have the normal on the outside,
then we will need to do a dot product to check the side.
</p>

<p>
If we always decide to return the normal against the direction of the ray,
then we will also need to provide information on whether the ray is
inside or outside.
</p>

<p>
In terms of which method to choose, the second one determines the side at geometry
intersection, whereas the first one determines at time of coloring. As the book
says, it is a matter of preference but because this book has more material types
than geometry types they have decided to put the determination at geometry
intersection time, to save work.
</p>

<p>
Let us update the appropriate sections of code:
</p>

<p>
First, we need to add an extra member to the <a href="util/hittable.h"><code>hit_record</code></a> struct, to store side information.
</p>

<div class="org-src-container">
<pre class="src src-C++">
<span style="color: #5317ac;">struct</span> <span style="color: #005a5f;">hit_record</span> <span style="color: #000000; background-color: #ffffff;">{</span>
  <span style="color: #005a5f;">point3</span> <span style="color: #00538b; font-style: italic;">point</span><span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #005a5f;">vec3</span> <span style="color: #00538b; font-style: italic;">norm</span><span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #8f0075;">double</span> <span style="color: #00538b; font-style: italic;">t</span><span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #8f0075;">bool</span> <span style="color: #00538b; font-style: italic;">front_face</span><span style="color: #000000; background-color: #ffffff;">;</span> <span style="color: #505050;">// confusing as to why its called front</span>

  <span style="color: #5317ac;">inline</span> <span style="color: #8f0075;">void</span> <span style="color: #721045; font-style: italic;">set_face_normal</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #5317ac;">const</span> <span style="color: #005a5f;">ray</span><span style="color: #5317ac;">&amp;</span> <span style="color: #00538b;">r</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #5317ac;">const</span> <span style="color: #005a5f;">vec3</span><span style="color: #5317ac;">&amp;</span> <span style="color: #00538b;">out_norm</span><span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #a8007f; background-color: #ffffff;">{</span>
    <span style="color: #00538b;">front_face</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">dot_product</span><span style="color: #005f88; background-color: #ffffff;">(</span>r<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">direction</span><span style="color: #904200; background-color: #ffffff;">()</span><span style="color: #000000; background-color: #ffffff;">,</span> out_norm<span style="color: #005f88; background-color: #ffffff;">)</span> <span style="color: #5317ac;">&lt;</span> <span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #00538b;">norm</span> <span style="color: #5317ac;">=</span> front_face <span style="color: #5317ac;">?</span> out_norm <span style="color: #5317ac;">:</span> <span style="color: #5317ac;">-</span>out_norm<span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #a8007f; background-color: #ffffff;">}</span>
<span style="color: #000000; background-color: #ffffff;">}</span>

</pre>
</div>

<p>
How does this affect our sphere implementation?
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #8f0075;">bool</span> <span style="color: #005a5f;">sphere</span>::<span style="color: #721045;">hit</span><span style="color: #000000; background-color: #ffffff;">(</span><span style="color: #5317ac;">const</span> <span style="color: #005a5f;">ray</span><span style="color: #5317ac;">&amp;</span><span style="color: #00538b;">r</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #8f0075;">double</span> <span style="color: #00538b;">t_min</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #8f0075;">double</span> <span style="color: #00538b;">t_max</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #005a5f;">hit_record</span><span style="color: #5317ac;">&amp;</span> <span style="color: #00538b;">rec</span><span style="color: #000000; background-color: #ffffff;">)</span> <span style="color: #5317ac;">const</span> <span style="color: #000000; background-color: #ffffff;">{</span>
  <span style="color: #005a5f;">ve</span> <span style="color: #00538b;">org_min_c</span> <span style="color: #5317ac;">=</span> r<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">origin</span><span style="color: #a8007f; background-color: #ffffff;">()</span> <span style="color: #5317ac;">-</span> center<span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #8f0075;">double</span> <span style="color: #00538b;">a</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">dot</span><span style="color: #a8007f; background-color: #ffffff;">(</span>r<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">direction</span><span style="color: #005f88; background-color: #ffffff;">()</span><span style="color: #000000; background-color: #ffffff;">,</span> r<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">direction</span><span style="color: #005f88; background-color: #ffffff;">()</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #8f0075;">double</span> <span style="color: #00538b;">h_b</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">dot</span><span style="color: #a8007f; background-color: #ffffff;">(</span>ray<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">direction</span><span style="color: #005f88; background-color: #ffffff;">()</span><span style="color: #000000; background-color: #ffffff;">,</span> org_min_c<span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #8f0075;">double</span> <span style="color: #00538b;">c</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">dot</span><span style="color: #a8007f; background-color: #ffffff;">(</span>org_min_c<span style="color: #000000; background-color: #ffffff;">,</span> org_min_c<span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #5317ac;">-</span> radius<span style="color: #5317ac;">*</span>radius<span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #8f0075;">double</span> <span style="color: #00538b;">discriminant</span> <span style="color: #5317ac;">=</span> h_b<span style="color: #5317ac;">*</span>h_b <span style="color: #5317ac;">-</span> a<span style="color: #5317ac;">*</span>c<span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #5317ac;">if</span> <span style="color: #a8007f; background-color: #ffffff;">(</span>discriminant <span style="color: #5317ac;">&lt;</span> <span style="color: #0000c0;">0</span><span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #a8007f; background-color: #ffffff;">{</span>
    <span style="color: #5317ac;">return</span> <span style="color: #8f0075;">false</span><span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #a8007f; background-color: #ffffff;">}</span> <span style="color: #5317ac;">else</span> <span style="color: #a8007f; background-color: #ffffff;">{</span>
    <span style="color: #8f0075;">double</span> <span style="color: #00538b;">sqrtd</span> <span style="color: #5317ac;">=</span> <span style="color: #005a5f;">std</span>::<span style="color: #0000c0;">sqrt</span><span style="color: #005f88; background-color: #ffffff;">(</span>discriminant<span style="color: #005f88; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #8f0075;">double</span> <span style="color: #00538b;">root</span> <span style="color: #5317ac;">=</span> <span style="color: #005f88; background-color: #ffffff;">(</span><span style="color: #5317ac;">-</span>h <span style="color: #5317ac;">-</span> sqrtd<span style="color: #005f88; background-color: #ffffff;">)</span> <span style="color: #5317ac;">/</span> a<span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #5317ac;">if</span> <span style="color: #005f88; background-color: #ffffff;">(</span>t_min <span style="color: #5317ac;">&gt;</span> root <span style="color: #5317ac;">||</span> t_max <span style="color: #5317ac;">&lt;</span> root<span style="color: #005f88; background-color: #ffffff;">)</span> <span style="color: #005f88; background-color: #ffffff;">{</span>
      <span style="color: #00538b;">root</span> <span style="color: #5317ac;">=</span> <span style="color: #904200; background-color: #ffffff;">(</span><span style="color: #5317ac;">-</span>h <span style="color: #5317ac;">+</span> sqrtd<span style="color: #904200; background-color: #ffffff;">)</span> <span style="color: #5317ac;">/</span> a<span style="color: #000000; background-color: #ffffff;">;</span>
      <span style="color: #5317ac;">if</span> <span style="color: #904200; background-color: #ffffff;">(</span>t_min <span style="color: #5317ac;">&gt;</span> root <span style="color: #5317ac;">||</span> t_max <span style="color: #5317ac;">&lt;</span> root<span style="color: #904200; background-color: #ffffff;">)</span> <span style="color: #904200; background-color: #ffffff;">{</span>
        <span style="color: #5317ac;">return</span> <span style="color: #8f0075;">false</span><span style="color: #000000; background-color: #ffffff;">;</span>
      <span style="color: #904200; background-color: #ffffff;">}</span>
    <span style="color: #005f88; background-color: #ffffff;">}</span>
    rec<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #00538b; font-style: italic;">t</span> <span style="color: #5317ac;">=</span> root<span style="color: #000000; background-color: #ffffff;">;</span>
    rec<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #00538b; font-style: italic;">point</span> <span style="color: #5317ac;">=</span> r<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">at</span><span style="color: #005f88; background-color: #ffffff;">(</span>rec<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">t</span><span style="color: #005f88; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #505050;">// rec.norm = unit_vector(rec.point - center); // this will always be radius</span>
    rec<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">set_face_normal</span><span style="color: #005f88; background-color: #ffffff;">(</span>r<span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">unit_vector</span><span style="color: #904200; background-color: #ffffff;">(</span>rec<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">point</span> <span style="color: #5317ac;">-</span> center<span style="color: #904200; background-color: #ffffff;">)</span><span style="color: #005f88; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>

    <span style="color: #5317ac;">return</span> <span style="color: #8f0075;">true</span><span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #a8007f; background-color: #ffffff;">}</span>
<span style="color: #000000; background-color: #ffffff;">}</span>
</pre>
</div>
<p>
The sphere implmentation can be found <a href="util/sphere.h">here</a>.
</p>
</div>
</div>

<div id="outline-container-orgb2b55f6" class="outline-4">
<h4 id="orgb2b55f6"><span class="section-number-4">4.4.2.</span> A List of Hittable Objects</h4>
<div class="outline-text-4" id="text-4-4-2">
<p>
With a generic object like hittable, we can make a class to store all the hittables! Now,
we can do hit detection on a collection of objects.
</p>

<p>
The file can be found <a href="util/hittable_list.h">here</a>.
</p>
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #5317ac;">class</span> <span style="color: #005a5f;">hittable_list</span> <span style="color: #000000; background-color: #ffffff;">{</span>
  <span style="color: #5317ac;">public</span>:
    <span style="color: #721045;">hittable_list</span><span style="color: #a8007f; background-color: #ffffff;">()</span> <span style="color: #a8007f; background-color: #ffffff;">{}</span>
    <span style="color: #721045;">hittable_list</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #005a5f;">shared_ptr</span><span style="color: #005f88;">&lt;</span><span style="color: #005a5f;">hittable</span><span style="color: #005f88;">&gt;</span> <span style="color: #00538b;">object</span><span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #a8007f; background-color: #ffffff;">{</span><span style="color: #0000c0;">add</span><span style="color: #005f88; background-color: #ffffff;">(</span>object<span style="color: #005f88; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span><span style="color: #a8007f; background-color: #ffffff;">}</span>

    <span style="color: #8f0075;">void</span> <span style="color: #721045; font-style: italic;">clear</span><span style="color: #a8007f; background-color: #ffffff;">()</span> <span style="color: #a8007f; background-color: #ffffff;">{</span> objects<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">clear</span><span style="color: #005f88; background-color: #ffffff;">()</span><span style="color: #000000; background-color: #ffffff;">;</span> <span style="color: #a8007f; background-color: #ffffff;">}</span>
    <span style="color: #8f0075;">void</span> <span style="color: #721045; font-style: italic;">add</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #005a5f;">shared_ptr</span><span style="color: #005f88;">&lt;</span><span style="color: #005a5f;">hittable</span><span style="color: #005f88;">&gt;</span> <span style="color: #00538b;">object</span><span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #a8007f; background-color: #ffffff;">{</span>
      objects<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">push_back</span><span style="color: #005f88; background-color: #ffffff;">(</span>object<span style="color: #005f88; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #a8007f; background-color: #ffffff;">}</span>

    <span style="color: #5317ac;">virtual</span> <span style="color: #8f0075;">bool</span> <span style="color: #721045; font-style: italic;">hit</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #5317ac;">const</span> <span style="color: #005a5f;">ray</span><span style="color: #5317ac;">&amp;</span> <span style="color: #00538b;">r</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #8f0075;">double</span> <span style="color: #00538b;">t_min</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #8f0075;">double</span> <span style="color: #00538b;">t_max</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #005a5f;">hit_record</span><span style="color: #5317ac;">&amp;</span> <span style="color: #00538b;">rec</span><span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #5317ac;">const</span> <span style="color: #5317ac;">override</span><span style="color: #000000; background-color: #ffffff;">;</span>

  <span style="color: #5317ac;">public</span>:
    <span style="color: #005a5f;">vector</span><span style="color: #a8007f;">&lt;</span><span style="color: #005a5f;">shared_ptr</span><span style="color: #005f88;">&lt;</span><span style="color: #005a5f;">hittable</span><span style="color: #005f88;">&gt;</span><span style="color: #a8007f;">&gt;</span> <span style="color: #00538b; font-style: italic;">objects</span><span style="color: #000000; background-color: #ffffff;">;</span>
<span style="color: #000000; background-color: #ffffff;">}</span><span style="color: #000000; background-color: #ffffff;">;</span>

<span style="color: #8f0075;">bool</span> <span style="color: #005a5f;">hittable_list</span>::<span style="color: #721045;">hit</span><span style="color: #000000; background-color: #ffffff;">(</span><span style="color: #5317ac;">const</span> <span style="color: #005a5f;">ray</span><span style="color: #5317ac;">&amp;</span> <span style="color: #00538b;">r</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #8f0075;">double</span> <span style="color: #00538b;">t_min</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #8f0075;">double</span> <span style="color: #00538b;">t_max</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #005a5f;">hit_record</span><span style="color: #5317ac;">&amp;</span> <span style="color: #00538b;">rec</span><span style="color: #000000; background-color: #ffffff;">)</span> <span style="color: #5317ac;">const</span> <span style="color: #000000; background-color: #ffffff;">{</span>
  <span style="color: #505050;">// probably want to distinguish between objects in front or behind</span>
  <span style="color: #005a5f;">hit_record</span> <span style="color: #00538b;">rec_temp</span><span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #8f0075;">bool</span> <span style="color: #00538b;">is_hit</span> <span style="color: #5317ac;">=</span> <span style="color: #8f0075;">false</span><span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #8f0075;">double</span> <span style="color: #00538b;">closest_hit</span> <span style="color: #5317ac;">=</span> <span style="color: #00538b;">t_max</span><span style="color: #000000; background-color: #ffffff;">;</span>

  <span style="color: #5317ac;">for</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #5317ac;">const</span> <span style="color: #005a5f;">auto</span> <span style="color: #5317ac;">&amp;</span>obj : objects<span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #a8007f; background-color: #ffffff;">{</span>
    <span style="color: #5317ac;">if</span> <span style="color: #005f88; background-color: #ffffff;">(</span>obj<span style="color: #5317ac;">-&gt;</span><span style="color: #0000c0; font-style: italic;">hit</span><span style="color: #904200; background-color: #ffffff;">(</span>r<span style="color: #000000; background-color: #ffffff;">,</span> t_min<span style="color: #000000; background-color: #ffffff;">,</span> closest_hit<span style="color: #000000; background-color: #ffffff;">,</span> rec_temp<span style="color: #904200; background-color: #ffffff;">)</span><span style="color: #005f88; background-color: #ffffff;">)</span> <span style="color: #005f88; background-color: #ffffff;">{</span>
      <span style="color: #00538b;">is_hit</span> <span style="color: #5317ac;">=</span> <span style="color: #8f0075;">true</span><span style="color: #000000; background-color: #ffffff;">;</span>
      <span style="color: #00538b;">closest_hit</span> <span style="color: #5317ac;">=</span> rec<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">t</span><span style="color: #000000; background-color: #ffffff;">;</span>
      <span style="color: #00538b;">rec</span> <span style="color: #5317ac;">=</span> rec_temp<span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #005f88; background-color: #ffffff;">}</span>
  <span style="color: #a8007f; background-color: #ffffff;">}</span>

  <span style="color: #5317ac;">return</span> is_hit<span style="color: #000000; background-color: #ffffff;">;</span>
<span style="color: #000000; background-color: #ffffff;">}</span><span style="color: #000000; background-color: #ffffff;">;</span>

</pre>
</div>
</div>
</div>

<div id="outline-container-org6bbf06c" class="outline-4">
<h4 id="org6bbf06c"><span class="section-number-4">4.4.3.</span> Wrapping Up With a Revised Example</h4>
<div class="outline-text-4" id="text-4-4-3">
<p>
Returning to the previous example, we re-write the program, now with another sphere
in the world, with radius 100 and centered around \((0, -100.5, -1)\).
</p>

<p>
The header file <a href="util/rtweekend.h"><code>rtweekend</code></a> has some useful constants like
infinity and pi, and a function for converting
degrees to radians.
</p>

<p>
/Note to Self: Remember to add semicolons to the end of your class/struct
declarations, as the errors that arise (Expected unqualified id) are not
very helpful./
</p>

<p>
<b>Source:</b>
</p>
<div class="org-src-container">
<pre class="src src-C++" id="orgc2ee56f"><span style="color: #a0132f;">#include</span> <span style="color: #2544bb;">"util/rtweekend.h"</span>
<span style="color: #a0132f;">#include</span> <span style="color: #2544bb;">"util/color.h"</span>
<span style="color: #a0132f;">#include</span> <span style="color: #2544bb;">"util/hittable.h"</span>
<span style="color: #a0132f;">#include</span> <span style="color: #2544bb;">"util/hittable_list.h"</span>
<span style="color: #a0132f;">#include</span> <span style="color: #2544bb;">"util/sphere.h"</span>

<span style="color: #a0132f;">#include</span> <span style="color: #2544bb;">&lt;iostream&gt;</span>

<span style="color: #505050;">// give it a ray and an object and it'll tell you what to color it</span>
<span style="color: #005a5f;">color</span> <span style="color: #721045;">ray_color</span><span style="color: #000000; background-color: #ffffff;">(</span><span style="color: #5317ac;">const</span> <span style="color: #005a5f;">ray</span><span style="color: #5317ac;">&amp;</span> <span style="color: #00538b;">r</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #5317ac;">const</span> <span style="color: #005a5f;">hittable</span><span style="color: #5317ac;">&amp;</span> <span style="color: #00538b;">world</span><span style="color: #000000; background-color: #ffffff;">)</span> <span style="color: #000000; background-color: #ffffff;">{</span>
  <span style="color: #005a5f;">hit_record</span> <span style="color: #00538b;">rec</span><span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #5317ac;">if</span> <span style="color: #a8007f; background-color: #ffffff;">(</span>world<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">hit</span><span style="color: #005f88; background-color: #ffffff;">(</span>r<span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">,</span> infinity<span style="color: #000000; background-color: #ffffff;">,</span> rec<span style="color: #005f88; background-color: #ffffff;">)</span><span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #a8007f; background-color: #ffffff;">{</span>
    <span style="color: #505050;">// if hit, return a color map</span>
    <span style="color: #5317ac;">return</span> <span style="color: #0000c0;">0.5</span> <span style="color: #5317ac;">*</span> <span style="color: #005f88; background-color: #ffffff;">(</span>rec<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">norm</span> <span style="color: #5317ac;">+</span> <span style="color: #0000c0;">vec3</span><span style="color: #904200; background-color: #ffffff;">(</span><span style="color: #0000c0;">1</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">1</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">1</span><span style="color: #904200; background-color: #ffffff;">)</span><span style="color: #005f88; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #a8007f; background-color: #ffffff;">}</span>
  <span style="color: #505050;">// otherwise, return sky gradient</span>
  <span style="color: #8f0075;">double</span> <span style="color: #00538b;">blue_portion</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">0.5</span> <span style="color: #5317ac;">*</span> <span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">unit_vector</span><span style="color: #005f88; background-color: #ffffff;">(</span>r<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">direction</span><span style="color: #904200; background-color: #ffffff;">()</span><span style="color: #005f88; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">y</span><span style="color: #005f88; background-color: #ffffff;">()</span> <span style="color: #5317ac;">+</span> <span style="color: #0000c0;">1.0</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #5317ac;">return</span> blue_portion <span style="color: #5317ac;">*</span> <span style="color: #0000c0;">color</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">0.5</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0.7</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">1.0</span><span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #5317ac;">+</span>
          <span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">1</span> <span style="color: #5317ac;">-</span> blue_portion<span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #5317ac;">*</span> <span style="color: #0000c0;">color</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">1</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">1</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">1</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
<span style="color: #000000; background-color: #ffffff;">}</span>

<span style="color: #8f0075;">int</span> <span style="color: #721045;">main</span><span style="color: #000000; background-color: #ffffff;">()</span> <span style="color: #000000; background-color: #ffffff;">{</span>
  <span style="color: #505050;">// set up width and height</span>
  <span style="color: #8f0075;">double</span> <span style="color: #00538b;">aspect</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">16.0</span><span style="color: #5317ac;">/</span><span style="color: #0000c0;">9.0</span><span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #8f0075;">int</span> <span style="color: #00538b;">img_width</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">600</span><span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #8f0075;">int</span> <span style="color: #00538b;">img_height</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">static_cast</span><span style="color: #a8007f;">&lt;</span><span style="color: #8f0075;">int</span><span style="color: #a8007f;">&gt;</span><span style="color: #a8007f; background-color: #ffffff;">(</span>img_width <span style="color: #5317ac;">/</span> aspect<span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>

  <span style="color: #505050;">// set up camera</span>
  <span style="color: #8f0075;">double</span> <span style="color: #00538b;">vp_height</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">2.0</span><span style="color: #000000; background-color: #ffffff;">;</span> <span style="color: #505050;">// we choose height here because height is known</span>
  <span style="color: #8f0075;">double</span> <span style="color: #00538b;">vp_width</span> <span style="color: #5317ac;">=</span> vp_height <span style="color: #5317ac;">*</span> aspect<span style="color: #000000; background-color: #ffffff;">;</span>

  <span style="color: #8f0075;">double</span> <span style="color: #00538b;">focal_length</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">1.0</span><span style="color: #000000; background-color: #ffffff;">;</span>

  <span style="color: #505050;">// useful parameters</span>
  <span style="color: #005a5f;">point3</span> <span style="color: #00538b;">origin</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #005a5f;">vec3</span> <span style="color: #00538b;">horizontal</span><span style="color: #a8007f; background-color: #ffffff;">(</span>vp_width<span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
  <span style="color: #005a5f;">vec3</span> <span style="color: #00538b;">vertical</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">,</span> vp_height<span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>

  <span style="color: #005a5f;">vec3</span> <span style="color: #00538b;">lower_left</span> <span style="color: #5317ac;">=</span> origin <span style="color: #5317ac;">-</span> horizontal <span style="color: #5317ac;">/</span> <span style="color: #0000c0;">2</span> <span style="color: #5317ac;">-</span> vertical <span style="color: #5317ac;">/</span> <span style="color: #0000c0;">2</span> <span style="color: #5317ac;">-</span> <span style="color: #0000c0;">vec3</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">,</span> focal_length<span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>

  <span style="color: #505050;">// set up the world</span>
  <span style="color: #005a5f;">hittable_list</span> <span style="color: #00538b;">world</span><span style="color: #000000; background-color: #ffffff;">;</span>
  world<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">add</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">make_shared</span><span style="color: #005f88;">&lt;</span><span style="color: #005a5f;">sphere</span><span style="color: #005f88;">&gt;</span><span style="color: #005f88; background-color: #ffffff;">(</span><span style="color: #0000c0;">point3</span><span style="color: #904200; background-color: #ffffff;">(</span><span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">-1</span><span style="color: #904200; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">0.5</span><span style="color: #005f88; background-color: #ffffff;">)</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
  world<span style="color: #000000; background-color: #ffffff;">.</span><span style="color: #0000c0; font-style: italic;">add</span><span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #0000c0;">make_shared</span><span style="color: #005f88;">&lt;</span><span style="color: #005a5f;">sphere</span><span style="color: #005f88;">&gt;</span><span style="color: #005f88; background-color: #ffffff;">(</span><span style="color: #0000c0;">point3</span><span style="color: #904200; background-color: #ffffff;">(</span><span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">-100.5</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">-1</span><span style="color: #904200; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">100</span><span style="color: #005f88; background-color: #ffffff;">)</span><span style="color: #a8007f; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>


  <span style="color: #505050;">// render time</span>
  <span style="color: #005a5f;">std</span>::cout <span style="color: #5317ac;">&lt;&lt;</span> <span style="color: #2544bb;">"P3\n"</span> <span style="color: #5317ac;">&lt;&lt;</span> img_width <span style="color: #5317ac;">&lt;&lt;</span> <span style="color: #2544bb;">" "</span> <span style="color: #5317ac;">&lt;&lt;</span> img_height <span style="color: #5317ac;">&lt;&lt;</span> <span style="color: #2544bb;">"\n255\n"</span><span style="color: #000000; background-color: #ffffff;">;</span>

  <span style="color: #5317ac;">for</span> <span style="color: #a8007f; background-color: #ffffff;">(</span><span style="color: #8f0075;">int</span> <span style="color: #00538b;">j</span> <span style="color: #5317ac;">=</span> img_height<span style="color: #5317ac;">-</span><span style="color: #0000c0;">1</span><span style="color: #000000; background-color: #ffffff;">;</span> j <span style="color: #5317ac;">&gt;=</span> <span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">;</span> <span style="color: #5317ac;">--</span><span style="color: #00538b;">j</span><span style="color: #a8007f; background-color: #ffffff;">)</span> <span style="color: #a8007f; background-color: #ffffff;">{</span>
    <span style="color: #5317ac;">for</span> <span style="color: #005f88; background-color: #ffffff;">(</span><span style="color: #8f0075;">int</span> <span style="color: #00538b;">i</span> <span style="color: #5317ac;">=</span> <span style="color: #0000c0;">0</span><span style="color: #000000; background-color: #ffffff;">;</span> i <span style="color: #5317ac;">&lt;</span> img_width<span style="color: #000000; background-color: #ffffff;">;</span> <span style="color: #5317ac;">++</span><span style="color: #00538b;">i</span><span style="color: #005f88; background-color: #ffffff;">)</span> <span style="color: #005f88; background-color: #ffffff;">{</span>
      <span style="color: #005a5f;">ray</span> <span style="color: #00538b;">r</span><span style="color: #904200; background-color: #ffffff;">(</span>origin<span style="color: #000000; background-color: #ffffff;">,</span> lower_left <span style="color: #5317ac;">+</span> vertical <span style="color: #5317ac;">*</span> <span style="color: #7f10d0; background-color: #ffffff;">(</span><span style="color: #8f0075;">double</span><span style="color: #006800; background-color: #ffffff;">(</span>j<span style="color: #006800; background-color: #ffffff;">)</span> <span style="color: #5317ac;">/</span> img_height<span style="color: #7f10d0; background-color: #ffffff;">)</span> <span style="color: #5317ac;">+</span>
                    horizontal <span style="color: #5317ac;">*</span> <span style="color: #7f10d0; background-color: #ffffff;">(</span><span style="color: #8f0075;">double</span><span style="color: #006800; background-color: #ffffff;">(</span>i<span style="color: #006800; background-color: #ffffff;">)</span> <span style="color: #5317ac;">/</span> img_width<span style="color: #7f10d0; background-color: #ffffff;">)</span> <span style="color: #5317ac;">-</span> origin<span style="color: #904200; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
      <span style="color: #0000c0;">write_color</span><span style="color: #904200; background-color: #ffffff;">(</span><span style="color: #005a5f;">std</span>::cout<span style="color: #000000; background-color: #ffffff;">,</span> <span style="color: #0000c0;">ray_color</span><span style="color: #7f10d0; background-color: #ffffff;">(</span>r<span style="color: #000000; background-color: #ffffff;">,</span> world<span style="color: #7f10d0; background-color: #ffffff;">)</span><span style="color: #904200; background-color: #ffffff;">)</span><span style="color: #000000; background-color: #ffffff;">;</span>
    <span style="color: #005f88; background-color: #ffffff;">}</span>
  <span style="color: #a8007f; background-color: #ffffff;">}</span>
<span style="color: #000000; background-color: #ffffff;">}</span>

</pre>
</div>

<p>
<b>Output:</b>
In the camera view, we see the original sphere as well as the gradient in the back
where no rays intersected any object. The green curvature is the top of the massive
sphere with radius 100, and it is green due to how our colormap was designed:
(normal with big positive y component \(\implies\) larger green value.)
</p>


<div id="orgb481706" class="figure">
<p><img src="./images/color-map-spheres.png" alt="color-map-spheres.png" />
</p>
</div>
</div>
</div>
</div>
</div>


<div id="outline-container-org0816dac" class="outline-2">
<h2 id="org0816dac"><span class="section-number-2">5.</span> Antialiasing</h2>
<div class="outline-text-2" id="text-5">
<p>
Notice the jagged lines of the smooth surface of the sphere. This is aliasing.
To get rid of this effect, we can average a bunch of pixels around the area to make it
look smoother.
The book says that we will not bother with <i>stratification</i>, but this may be
something that I might look into later. The argument offered as to why
we will not implement stratification is because our ray-tracer will not
benefit much from this and makes the code much more complex.
</p>

<p>
To begin, we start with some more abstractions.
</p>
</div>

<div id="outline-container-org8958a20" class="outline-3">
<h3 id="org8958a20"><span class="section-number-3">5.1.</span> Random Number Generation</h3>
</div>

<div id="outline-container-orge6fbab3" class="outline-3">
<h3 id="orge6fbab3"><span class="section-number-3">5.2.</span> Abstracting the Camera</h3>
</div>
</div>
</div>
</body>
</html>
